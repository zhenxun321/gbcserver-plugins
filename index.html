<!DOCTYPE html>

<html lang="zh-CN">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>嘎嘣脆服务器综合管理系统</title>
<link href="images/gbc.jpg" rel="icon" type="image/jpg"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet"/>
<style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2c3e50;
            --accent-color: #e74c3c;
            --success-color: #2ecc71;
            --warning-color: #f39c12;
            --sidebar-width: 250px;
            --header-height: 70px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }

        body {
            background-color: #f5f7fa;
            color: #333;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* 在原有样式中添加离线状态样式 */
        .server-card.offline {
            border-left: 4px solid var(--accent-color) !important;
            /* 确保离线状态边框为红色 */
        }

        /* 登录界面样式 */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            /* Use the same background image as index.html (#header) */
            background:
                radial-gradient(1000px 600px at 50% 20%, rgba(82, 100, 174, .25), transparent 55%),
                linear-gradient(135deg, rgba(215, 236, 255, .88) 0%, rgba(255, 255, 255, .88) 45%, rgba(215, 236, 255, .88) 100%),
                url('images/hbg.webp');
            background-size: cover;
            background-position: center;
            padding: 20px;
        }

        .login-card {
            background: white;
            position: relative;
            z-index: 1;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            width: 100%;
            max-width: 450px;
            padding: 40px;
            text-align: center;
        }

        .login-logo {
            margin-bottom: 30px;
        }

        .login-logo h1 {
            font-size: 2.2rem;
            color: var(--secondary-color);
            margin-bottom: 10px;
        }

        .login-logo p {
            color: #777;
            font-size: 1rem;
        }

        .login-form {
            margin-bottom: 25px;
        }

        .input-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #555;
        }

        .admin-only-hidden {
            display: none;
        }

        .input-group input {
            width: 100%;
            padding: 14px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s;
        }

        .input-group input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
            outline: none;
        }

        .login-options {
            display: flex;
            justify-content: space-between;
            margin-bottom: 25px;
            font-size: 0.9rem;
        }

        .remember-me {
            display: flex;
            align-items: center;
        }

        .remember-me input {
            margin-right: 8px;
        }

        .forgot-password {
            color: var(--primary-color);
            text-decoration: none;
        }

        .login-button {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 8px;
            background-color: var(--primary-color);
            color: #fff;
            font-size: 1.1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 20px;
        }

        .login-button:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
        }

        .admin-login-button {
            background-color: var(--secondary-color);
        }

        .admin-login-button:hover {
            background-color: #1a2530;
        }

        .register-link {
            color: #777;
            font-size: 0.95rem;
        }

        .register-link a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 500;
        }

        /* 主系统样式 */
        .main-system {
            display: none;
            flex: 1;
            min-height: 100vh;
            /* Main UI background: same as index.html (#header) */
            background-image: url('images/hbg.webp');
            background-size: cover;
            background-position: center;
            position: relative;
            isolation: isolate;
        }
        .main-system:before {
            content: "";
            position: absolute;
            inset: 0;
            background:
                radial-gradient(1000px 600px at 50% 20%, rgba(82, 100, 174, .25), transparent 55%),
                linear-gradient(to bottom, rgba(0, 0, 0, .35), rgba(0, 0, 0, .65));
            z-index: -1;
        }

        /* 侧边栏样式 */
        .sidebar {
            width: var(--sidebar-width);
            background: var(--secondary-color);
            color: white;
            height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            overflow-y: auto;
            box-shadow: 3px 0 10px rgba(0, 0, 0, 0.2);
            z-index: 100;
        }

        .sidebar-header {
            padding: 25px 20px 20px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .sidebar-header h2 {
            font-size: 1.5rem;
            margin-bottom: 10px;
            color: #fff;
        }

        .sidebar-header p {
            font-size: 0.85rem;
            opacity: 0.7;
        }

        .nav-item {
            padding: 15px 25px;
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s;
            border-left: 4px solid transparent;
        }

        .nav-item i {
            margin-right: 15px;
            font-size: 1.2rem;
            width: 20px;
            text-align: center;
        }

        .nav-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .nav-item.active {
            background: rgba(255, 255, 255, 0.15);
            border-left: 4px solid var(--primary-color);
        }

        .nav-divider {
            height: 1px;
            background: rgba(255, 255, 255, 0.1);
            margin: 10px 20px;
        }

        /* 优化服务器加载状态样式 */
        .server-loading {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border-radius: 10px;
            z-index: 10;
            opacity: 1;
            transition: opacity 0.3s ease;
        }

        /* 添加平滑过渡效果 */
        .server-loading.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .loading-text {
            color: var(--secondary-color);
            font-size: 0.9rem;
        }

        /* 主内容区域 */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            padding: 25px;
        }

        .header {
            background: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .page-title {
            font-size: 1.8rem;
            color: var(--secondary-color);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }

        .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .avatar-edit {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.5);
            color: white;
            font-size: 0.7rem;
            text-align: center;
            padding: 3px;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .user-avatar:hover .avatar-edit {
            opacity: 1;
        }

        .user-details {
            display: flex;
            flex-direction: column;
        }

        .user-name {
            font-weight: 600;
        }

        .user-status {
            font-size: 0.85rem;
            color: var(--success-color);
        }

        /* 内容卡片样式 */
        .content-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            padding: 30px;
            margin-bottom: 30px;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }

        .card-header h2 {
            font-size: 1.5rem;
            color: var(--secondary-color);
        }

        .card-header .actions {
            display: flex;
            gap: 10px;
        }

        /* 服务器状态样式 */
        .server-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .server-card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            padding: 20px;
            border-left: 4px solid var(--success-color);
            transition: transform 0.3s;
        }

        .server-card.offline {
            border-left-color: var(--accent-color);
        }

        .server-card:hover {
            transform: translateY(-5px);
        }

        .server-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .server-name {
            font-weight: 600;
            font-size: 1.1rem;
        }

        .server-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        #server-login-btn {
            display: block;
            /* 默认显示 */
        }

        #server-logout-btn {
            display: none;
            /* 默认隐藏 */
        }

        .server-status {
            font-size: 0.85rem;
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: 500;
        }

        .status-online {
            background: rgba(46, 204, 113, 0.15);
            color: var(--success-color);
        }

        .status-offline {
            background: rgba(231, 76, 60, 0.15);
            color: var(--accent-color);
        }

        .server-info {
            margin-bottom: 15px;
        }

        .server-address {
            color: #666;
            font-size: 0.95rem;
            margin-bottom: 10px;
        }

        .server-stats {
            display: flex;
            gap: 15px;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
        }

        .stat-label {
            font-size: 0.85rem;
            color: #888;
        }

        .stat-value {
            font-weight: 600;
            font-size: 1.1rem;
        }

        .server-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .server-button {
            flex: 1;
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            background: #f0f2f5;
            color: #555;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .server-button:hover {
            background: var(--primary-color);
            color: white;
        }

        .server-button.primary {
            background: var(--primary-color);
            color: white;
        }

        /* 添加禁用按钮样式 */
        .action-button.disabled {
            background: #cccccc !important;
            cursor: not-allowed !important;
            transform: none !important;
        }

        .action-button.disabled:hover {
            background: #cccccc !important;
        }

        .server-button.primary:hover {
            background: #2980b9;
        }

        .server-button.danger {
            background: var(--accent-color);
            color: white;
        }

        .server-button.danger:hover {
            background: #c0392b;
        }

        .admin-only {
            display: none;
            /* 默认隐藏管理员专用元素 */
        }

        /* 账户设置样式 */
        .account-grid {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 30px;
        }

        .avatar-section {
            text-align: center;
        }

        .avatar-preview {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            margin: 0 auto 20px;
            background: #f0f2f5;
            position: relative;
            overflow: hidden;
            border: 3px solid white;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }

        .avatar-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .avatar-upload {
            margin-top: 20px;
        }

        .upload-button {
            display: inline-block;
            padding: 10px 20px;
            background: var(--primary-color);
            color: white;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .upload-button:hover {
            background: #2980b9;
        }

        #avatar-input {
            display: none;
        }

        .account-info {
            margin-top: 30px;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .info-card {
            background: #f9fafb;
            border-radius: 10px;
            padding: 20px;
            border-left: 3px solid var(--primary-color);
        }

        .info-title {
            font-size: 0.9rem;
            color: #777;
            margin-bottom: 8px;
        }

        .info-value {
            font-size: 1.2rem;
            font-weight: 600;
        }

        .info-actions {
            display: flex;
            gap: 15px;
        }

        .action-button {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            background: var(--primary-color);
            color: white;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
        }

        .action-button:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }

        /* 添加操作按钮样式 */
        .action-buttons {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }

        .server-button.small {
            padding: 4px 8px;
            font-size: 0.8rem;
        }

        .server-button.success {
            background-color: #27ae60;
        }

        .server-button.success:hover {
            background-color: #219653;
        }

        .calendar-day.other-month {
            opacity: 0.5;
            background-color: #f0f0f0;
            cursor: not-allowed;
        }

        .calendar-day.today {
            border: 2px solid #3498db;
            font-weight: bold;
        }

        .calendar-day.signed {
            background-color: #2ecc71;
            color: white;
        }

        /* 注册/忘记密码弹窗 */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            width: 90%;
            max-width: 500px;
            padding: 30px;
            position: relative;
        }

        .close-button {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 1.5rem;
            cursor: pointer;
            color: #777;
        }

        .modal-header {
            margin-bottom: 20px;
        }

        .modal-header h2 {
            color: var(--secondary-color);
        }

        .modal-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #eee;
        }

        .modal-tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
        }

        .modal-tab.active {
            border-bottom: 3px solid var(--primary-color);
            color: var(--primary-color);
            font-weight: 500;
        }

        .modal-body {
            margin-bottom: 20px;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        /* 签到系统样式 */
        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            margin-top: 20px;
        }

        .calendar-header {
            text-align: center;
            padding: 10px;
            font-weight: bold;
            color: #555;
        }

        .calendar-day {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .calendar-day:hover {
            background: #e9ecef;
        }

        .calendar-day.signed {
            background: var(--success-color);
            color: white;
        }

        .calendar-day.today {
            border: 2px solid var(--primary-color);
        }

        .calendar-day.disabled {
            background: #f0f2f5;
            color: #ccc;
            cursor: not-allowed;
        }

        .sign-rewards {
            margin-top: 30px;
        }

        .rewards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .reward-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            position: relative;
        }

        .reward-item.received {
            background: rgba(46, 204, 113, 0.15);
        }

        .reward-item.current {
            border: 2px solid var(--primary-color);
        }

        .reward-day {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .reward-name {
            font-size: 0.9rem;
            color: #555;
        }

        .shop-item-card .item-image img {
            max-width: 100%;
            max-height: 200px;
            object-fit: contain;
        }

        /* 排行榜样式 */
        .leaderboard-table {
            margin-top: 20px;
            overflow-x: auto;
        }

        .leaderboard-table table {
            width: 100%;
            border-collapse: collapse;
        }

        .leaderboard-table th,
        .leaderboard-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .leaderboard-table th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: #555;
        }

        .leaderboard-table tr:hover {
            background-color: #f8f9fa;
        }

        .leaderboard-table .rank {
            font-weight: bold;
            color: var(--primary-color);
            width: 50px;
        }

        .leaderboard-table .player-info {
            display: flex;
            align-items: center;
        }

        .leaderboard-table .player-avatar {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            margin-right: 10px;
            object-fit: cover;
        }

        /* 积分表格样式 */
        .points-table {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }

        @media (max-width: 992px) {
            .points-table {
                grid-template-columns: 1fr;
            }
        }

        .points-table table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 15px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .points-table th {
            background-color: var(--primary-color);
            color: white;
            font-weight: 500;
            padding: 10px 12px;
            text-align: center;
        }

        .points-table td {
            padding: 8px 12px;
            text-align: center;
            border-bottom: 1px solid #eee;
        }

        .points-table caption {
            font-weight: 600;
            padding: 10px;
            background: #f8f9fa;
            text-align: center;
            font-size: 1.1rem;
            color: var(--secondary-color);
        }

        .points-table tfoot td {
            background: #f9fafb;
            font-weight: 500;
            text-align: center;
            color: var(--primary-color);
        }

        .points-table .highlight-row {
            background: rgba(46, 204, 113, 0.1);
            font-weight: 600;
        }

        /* 小贴士样式 */
        .points-tips {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            border-left: 3px solid var(--warning-color);
        }

        .points-tips ul {
            padding-left: 20px;
            margin: 10px 0;
        }

        .points-tips li {
            margin-bottom: 8px;
        }

        .points-tips i {
            color: var(--warning-color);
            margin-right: 8px;
        }

        /* 用户管理表格 */
        .user-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .user-table th,
        .user-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .user-table th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: #555;
        }

        .user-table tr:hover {
            background-color: #f8f9fa;
        }

        .status-active {
            color: var(--success-color);
            font-weight: 500;
        }

        .status-inactive {
            color: var(--warning-color);
            font-weight: 500;
        }

        .status-banned {
            color: var(--accent-color);
            font-weight: 500;
        }

        /* 响应式设计 */
        @media (max-width: 992px) {
            .sidebar {
                width: 70px;
            }

            .sidebar-header h2,
            .sidebar-header p,
            .nav-text {
                display: none;
            }

            .nav-item {
                justify-content: center;
                padding: 15px;
            }

            .nav-item i {
                margin-right: 0;
                font-size: 1.4rem;
            }

            .main-content {
                margin-left: 70px;
            }
        

            /* Mobile: make torch theme toggle easier to tap */
            .nav-item.torch-item .torch-toggle{
                width: 44px !important;
                height: 44px !important;
                flex: 0 0 44px !important;
                margin-right: 0 !important;
            }
            .nav-item.torch-item .torch-container.mini{
                transform: scale(0.14) !important;
                transform-origin: center center !important;
            }
}

        @media (max-width: 768px) {
            .account-grid {
                grid-template-columns: 1fr;
            }

            .info-grid {
                grid-template-columns: 1fr;
            }

            .header {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }

            .user-info {
                width: 100%;
                justify-content: flex-start;
            }

            .server-grid {
                grid-template-columns: 1fr;
            }
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 8px;
            background: white;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            z-index: 2000;
            transform: translateX(200%);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            border-left: 4px solid var(--success-color);
        }

        .notification.error {
            border-left: 4px solid var(--accent-color);
        }

        .notification.warning {
            border-left: 4px solid var(--warning-color);
        }

        /* 管理员登录样式 */
        .admin-login-section {
            display: none;
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            display: none;
        }
    
/* Honeycomb Loader (From Uiverse.io by boryanakrasteva) */
@-webkit-keyframes honeycomb {
  0%, 20%, 80%, 100% { opacity: 0; -webkit-transform: scale(0); transform: scale(0); }
  30%, 70% { opacity: 1; -webkit-transform: scale(1); transform: scale(1); }
}
@keyframes honeycomb {
  0%, 20%, 80%, 100% { opacity: 0; -webkit-transform: scale(0); transform: scale(0); }
  30%, 70% { opacity: 1; -webkit-transform: scale(1); transform: scale(1); }
}
.honeycomb { height: 24px; position: relative; width: 24px; }
.honeycomb div {
  -webkit-animation: honeycomb 2.1s infinite backwards;
  animation: honeycomb 2.1s infinite backwards;
  background: #f3f3f3;
  height: 12px;
  margin-top: 6px;
  position: absolute;
  width: 24px;
}
.honeycomb div:after, .honeycomb div:before {
  content: '';
  border-left: 12px solid transparent;
  border-right: 12px solid transparent;
  position: absolute;
  left: 0;
  right: 0;
}
.honeycomb div:after { top: -6px; border-bottom: 6px solid #f3f3f3; }
.honeycomb div:before { bottom: -6px; border-top: 6px solid #f3f3f3; }
.honeycomb div:nth-child(1) { -webkit-animation-delay: 0s; animation-delay: 0s; left: -28px; top: 0; }
.honeycomb div:nth-child(2) { -webkit-animation-delay: 0.1s; animation-delay: 0.1s; left: -14px; top: 22px; }
.honeycomb div:nth-child(3) { -webkit-animation-delay: 0.2s; animation-delay: 0.2s; left: 14px; top: 22px; }
.honeycomb div:nth-child(4) { -webkit-animation-delay: 0.3s; animation-delay: 0.3s; left: 28px; top: 0; }
.honeycomb div:nth-child(5) { -webkit-animation-delay: 0.4s; animation-delay: 0.4s; left: 14px; top: -22px; }
.honeycomb div:nth-child(6) { -webkit-animation-delay: 0.5s; animation-delay: 0.5s; left: -14px; top: -22px; }
.honeycomb div:nth-child(7) { -webkit-animation-delay: 0.6s; animation-delay: 0.6s; left: 0; top: 0; }

/* Page Splash Loader */
#page-splash {
  position: fixed;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  background: #111;
  z-index: 99999;
}
body.loading {
  overflow: hidden;
}
body.loading #app { display: none; }
body.loading #page-splash { display: flex; }
body:not(.loading) #page-splash { display: none; }



/* ===== Torch theme toggle (Uiverse.io by KSAplay) ===== */
.torch-item {
  justify-content: space-between;
}

.torch-item .nav-left {
  display: inline-flex;
  align-items: center;
  min-width: 0;
}

.torch-item{
  display:flex;
  align-items:center;
  gap:12px;
}
.torch-toggle {
  margin-left: 0;
  width: 48px;
  height: 34px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  flex: 0 0 48px;
}

.torch-container input {
  position: absolute;
  opacity: 0;
  cursor: pointer;
  height: 0;
  width: 0;
}

.torch-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  position: relative;
  cursor: pointer;
  user-select: none;
}

/* mini size for sidebar */
.torch-container.mini {
  transform: scale(0.18);
  transform-origin: left center;
  width: auto;
  height: auto;
}

.torch {
  display: flex;
  justify-content: center;
  height: 150px;
}

.head,
.stick {
  position: absolute;
  width: 30px;
  transform-style: preserve-3d;
  transform: rotateX(-30deg) rotateY(45deg);
}

.stick {
  position: relative;
  height: 120px;
}

.face {
  position: absolute;
  transform-style: preserve-3d;
  width: 30px;
  height: 30px;
  display: grid;
  grid-template-columns: 50% 50%;
  grid-template-rows: 50% 50%;
  background-color: #000000;
}

.top {
  transform: rotateX(90deg) translateZ(15px);
}

.left {
  transform: rotateY(-90deg) translateZ(15px);
}

.right {
  transform: rotateY(0deg) translateZ(15px);
}

.top div,
.left div,
.right div {
  width: 102%;
  height: 102%;
}

.top div:nth-child(1),
.left div:nth-child(3),
.right div:nth-child(3) {
  background-color: #ffff9760;
}

.top div:nth-child(2),
.left div:nth-child(1),
.right div:nth-child(1) {
  background-color: #ffd80060;
}

.top div:nth-child(3),
.left div:nth-child(4),
.right div:nth-child(4) {
  background-color: #ffffff60;
}

.top div:nth-child(4),
.left div:nth-child(2),
.right div:nth-child(2) {
  background-color: #ff8f0060;
}

.side {
  position: absolute;
  width: 30px;
  height: 120px;
  display: grid;
  grid-template-columns: 50% 50%;
  grid-template-rows: repeat(8, 12.5%);
  cursor: pointer;
  translate: 0 12px;
}

.side-left {
  transform: rotateY(-90deg) translateZ(15px) translateY(8px);
}

.side-right {
  transform: rotateY(0deg) translateZ(15px) translateY(8px);
}

.side-left div,
.side-right div {
  width: 103%;
  height: 103%;
}

.side div:nth-child(1) { background-color: #443622; }
.side div:nth-child(2) { background-color: #2e2517; }
.side div:nth-child(3) { background-color: #4b3b23; }
.side div:nth-child(4) { background-color: #251e12; }
.side div:nth-child(5) { background-color: #4b3b23; }
.side div:nth-child(6) { background-color: #292115; }
.side div:nth-child(7) { background-color: #4b3c26; }
.side div:nth-child(8) { background-color: #292115; }
.side div:nth-child(9) { background-color: #4b3a21; }
.side div:nth-child(10){ background-color: #251e12; }
.side div:nth-child(11){ background-color: #3d311d; }
.side div:nth-child(12){ background-color: #2c2315; }
.side div:nth-child(13){ background-color: #493a22; }
.side div:nth-child(14){ background-color: #2b2114; }
.side div:nth-child(15){ background-color: #3d311d; }
.side div:nth-child(16){ background-color: #271e10; }

.torch-container input:checked ~ .torch .face {
  filter: drop-shadow(0px 0px 2px rgb(255, 255, 255))
    drop-shadow(0px 0px 10px rgba(255, 237, 156, 0.7))
    drop-shadow(0px 0px 25px rgba(255, 227, 101, 0.4));
}

.torch-container input:checked ~ .torch .top div:nth-child(1),
.torch-container input:checked ~ .torch .left div:nth-child(3),
.torch-container input:checked ~ .torch .right div:nth-child(3) { background-color: #ffff97; }

.torch-container input:checked ~ .torch .top div:nth-child(2),
.torch-container input:checked ~ .torch .left div:nth-child(1),
.torch-container input:checked ~ .torch .right div:nth-child(1) { background-color: #ffd800; }

.torch-container input:checked ~ .torch .top div:nth-child(3),
.torch-container input:checked ~ .torch .left div:nth-child(4),
.torch-container input:checked ~ .torch .right div:nth-child(4) { background-color: #ffffff; }

.torch-container input:checked ~ .torch .top div:nth-child(4),
.torch-container input:checked ~ .torch .left div:nth-child(2),
.torch-container input:checked ~ .torch .right div:nth-child(2) { background-color: #ff8f00; }

.torch-container input:checked ~ .torch .side div:nth-child(1)  { background-color: #7c623e; }
.torch-container input:checked ~ .torch .side div:nth-child(2)  { background-color: #4c3d26; }
.torch-container input:checked ~ .torch .side div:nth-child(3)  { background-color: #937344; }
.torch-container input:checked ~ .torch .side div:nth-child(4)  { background-color: #3c2f1c; }
.torch-container input:checked ~ .torch .side div:nth-child(5)  { background-color: #937344; }
.torch-container input:checked ~ .torch .side div:nth-child(6)  { background-color: #423522; }
.torch-container input:checked ~ .torch .side div:nth-child(7)  { background-color: #9f7f50; }
.torch-container input:checked ~ .torch .side div:nth-child(8)  { background-color: #403320; }
.torch-container input:checked ~ .torch .side div:nth-child(9)  { background-color: #977748; }
.torch-container input:checked ~ .torch .side div:nth-child(10) { background-color: #3c2f1c; }
.torch-container input:checked ~ .torch .side div:nth-child(11) { background-color: #675231; }
.torch-container input:checked ~ .torch .side div:nth-child(12) { background-color: #3d301d; }
.torch-container input:checked ~ .torch .side div:nth-child(13) { background-color: #987849; }
.torch-container input:checked ~ .torch .side div:nth-child(14) { background-color: #3b2e1b; }
.torch-container input:checked ~ .torch .side div:nth-child(15) { background-color: #675231; }
.torch-container input:checked ~ .torch .side div:nth-child(16) { background-color: #372a17; }

/* ===== Dark theme overrides ===== */
body.theme-dark {
  background-color: #0f1115;
  color: #e9e9ea;
}

body.theme-dark .content-card {
  background: #151a23;
  color: #e9e9ea;
  box-shadow: 0 8px 24px rgba(0,0,0,0.35);
}

body.theme-dark .card-header {
  border-bottom: 1px solid rgba(255,255,255,0.08);
}

body.theme-dark .main-content,
body.theme-dark .page-content {
  color: #e9e9ea;
}

body.theme-dark input,
body.theme-dark textarea,
body.theme-dark select {
  background: #0f1115 !important;
  color: #e9e9ea !important;
  border-color: rgba(255,255,255,0.15) !important;
}

body.theme-dark .server-card,
body.theme-dark .stat-card,
body.theme-dark .profile-card {
  background: #151a23;
  color: #e9e9ea;
}

body.theme-dark .nav-item {
  color: rgba(255,255,255,0.9);
}

body.theme-dark .nav-item:hover {
  background: rgba(255,255,255,0.06);
}

body.theme-dark .nav-item.active {
  background: rgba(255,255,255,0.10);
}

/* ===== Dark theme typography fix ===== */
body.theme-dark .login-card,
body.theme-dark .modal-content,
body.theme-dark .server-details,
body.theme-dark .account-container,
body.theme-dark .support-container {
  background: #151a23;
  color: #e9e9ea;
}

body.theme-dark .main-content,
body.theme-dark .main-content h1,
body.theme-dark .main-content h2,
body.theme-dark .main-content h3,
body.theme-dark .main-content h4,
body.theme-dark .main-content h5,
body.theme-dark .main-content h6,
body.theme-dark .main-content p,
body.theme-dark .main-content span,
body.theme-dark .main-content label,
body.theme-dark .main-content li,
body.theme-dark .main-content td,
body.theme-dark .main-content th {
  color: #e9e9ea;
}

body.theme-dark a {
  color: #8ab4ff;
}

body.theme-dark ::placeholder {
  color: rgba(233, 233, 234, 0.65);
}

body.theme-dark .text-muted,
body.theme-dark .hint,
body.theme-dark .help-text {
  color: rgba(233, 233, 234, 0.75) !important;
}

/* ===== Torch nav item alignment fix ===== */
.nav-item.torch-item .torch-toggle { margin-right: 15px; }
.nav-item.torch-item { justify-content: flex-start; }
/* Prevent torch widget from stretching the row */
.nav-item.torch-item .torch-container { pointer-events: auto; }
/* ===== /Torch nav item alignment fix ===== */

/* ===== Dark theme extra fixes ===== */
body.theme-dark .header {
  background: #151a23;
  color: #e9e9ea;
  box-shadow: 0 8px 24px rgba(0,0,0,0.35);
}

body.theme-dark .header h1,
body.theme-dark .header h2,
body.theme-dark .header h3,
body.theme-dark .header p,
body.theme-dark .header span,
body.theme-dark .user-name,
body.theme-dark .user-status {
  color: #e9e9ea;
}

body.theme-dark .user-status {
  opacity: 0.85;
}

body.theme-dark .calendar-header { color: rgba(233,233,234,0.85); }
body.theme-dark .calendar-day {
  background: #1b2230;
  color: #e9e9ea;
}
body.theme-dark .calendar-day:hover { background: #222b3a; }
body.theme-dark .calendar-day.other-month {
  background-color: #131a24;
  opacity: 0.45;
}

body.theme-dark .leaderboard-table th,
body.theme-dark .leaderboard-table td {
  border-bottom: 1px solid rgba(255,255,255,0.10);
}
body.theme-dark .leaderboard-table th {
  background-color: #1b2230;
  color: rgba(233,233,234,0.9);
}
body.theme-dark .leaderboard-table tr:hover { background-color: rgba(255,255,255,0.06); }

body.theme-dark .avatar-preview {
  background: #1b2230;
  border: 3px solid rgba(255,255,255,0.08);
  box-shadow: 0 8px 24px rgba(0,0,0,0.35);
}

body.theme-dark .info-card {
  background: #151a23;
  color: #e9e9ea;
  border-left-color: var(--primary-color);
}

body.theme-dark .info-title { color: rgba(233,233,234,0.75); }
body.theme-dark .info-value { color: #e9e9ea; }

body.theme-dark .server-loading {
  background: rgba(15, 17, 21, 0.85);
  color: #e9e9ea;
}
/* ===== /Dark theme extra fixes ===== */

/* ===== MC icons for sidebar (v5) ===== */
.nav-item .mc-icon {
  margin-right: 15px;
  width: 20px;
  height: 20px;
  display: inline-block;
  background-size: contain;
  background-repeat: no-repeat;
  background-position: center;
  image-rendering: pixelated;
  flex: 0 0 auto;
}
.mc-user { background-image: url("data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20width=%2220%22%20height=%2220%22%20viewBox=%220%200%2020%2020%22%20shape-rendering=%22crispEdges%22%3E%0A%20%20%3Crect%20width=%2220%22%20height=%2220%22%20fill=%22#6fb1e6%22/%3E%0A%20%20%3Crect%20x=%223%22%20y=%223%22%20width=%2214%22%20height=%2214%22%20fill=%22#c68642%22/%3E%0A%20%20%3Crect%20x=%223%22%20y=%223%22%20width=%2214%22%20height=%225%22%20fill=%22#3b2b20%22/%3E%0A%20%20%3Crect%20x=%226%22%20y=%229%22%20width=%223%22%20height=%223%22%20fill=%22#2b5aa6%22/%3E%0A%20%20%3Crect%20x=%2211%22%20y=%229%22%20width=%223%22%20height=%223%22%20fill=%22#2b5aa6%22/%3E%0A%20%20%3Crect%20x=%228%22%20y=%2213%22%20width=%224%22%20height=%222%22%20fill=%22#8b5a2b%22/%3E%0A%3C/svg%3E"); }
.mc-sign { background-image: url("data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20width=%2220%22%20height=%2220%22%20viewBox=%220%200%2020%2020%22%20shape-rendering=%22crispEdges%22%3E%0A%20%20%3Crect%20width=%2220%22%20height=%2220%22%20fill=%22none%22/%3E%0A%20%20%3Crect%20x=%223%22%20y=%224%22%20width=%2214%22%20height=%2213%22%20fill=%22#d9dde3%22/%3E%0A%20%20%3Crect%20x=%223%22%20y=%224%22%20width=%2214%22%20height=%224%22%20fill=%22#c84c4c%22/%3E%0A%20%20%3Crect%20x=%226%22%20y=%222%22%20width=%222%22%20height=%224%22%20fill=%22#6b6f76%22/%3E%0A%20%20%3Crect%20x=%2212%22%20y=%222%22%20width=%222%22%20height=%224%22%20fill=%22#6b6f76%22/%3E%0A%20%20%3Crect%20x=%225%22%20y=%2210%22%20width=%223%22%20height=%223%22%20fill=%22#8fbf6a%22/%3E%0A%20%20%3Crect%20x=%229%22%20y=%2210%22%20width=%223%22%20height=%223%22%20fill=%22#8fbf6a%22/%3E%0A%20%20%3Crect%20x=%2213%22%20y=%2210%22%20width=%222%22%20height=%223%22%20fill=%22#8fbf6a%22/%3E%0A%3C/svg%3E"); }
.mc-shop { background-image: url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2220%22%20height%3D%2220%22%20viewBox%3D%220%200%2020%2020%22%20shape-rendering%3D%22crispEdges%22%3E%20%3Crect%20width%3D%2220%22%20height%3D%2220%22%20fill%3D%22none%22%2F%3E%20%3C%21--%20handle%20--%3E%20%3Crect%20x%3D%224%22%20y%3D%224%22%20width%3D%222%22%20height%3D%221%22%20fill%3D%22%234a4f57%22%2F%3E%20%3Crect%20x%3D%223%22%20y%3D%225%22%20width%3D%221%22%20height%3D%223%22%20fill%3D%22%234a4f57%22%2F%3E%20%3C%21--%20basket%20outline%20--%3E%20%3Crect%20x%3D%225%22%20y%3D%226%22%20width%3D%2211%22%20height%3D%221%22%20fill%3D%22%234a4f57%22%2F%3E%20%3Crect%20x%3D%225%22%20y%3D%227%22%20width%3D%221%22%20height%3D%226%22%20fill%3D%22%234a4f57%22%2F%3E%20%3Crect%20x%3D%2215%22%20y%3D%227%22%20width%3D%221%22%20height%3D%226%22%20fill%3D%22%234a4f57%22%2F%3E%20%3Crect%20x%3D%226%22%20y%3D%2212%22%20width%3D%229%22%20height%3D%221%22%20fill%3D%22%234a4f57%22%2F%3E%20%3C%21--%20basket%20fill%20--%3E%20%3Crect%20x%3D%226%22%20y%3D%227%22%20width%3D%229%22%20height%3D%225%22%20fill%3D%22%23b8bec7%22%2F%3E%20%3Crect%20x%3D%226%22%20y%3D%229%22%20width%3D%229%22%20height%3D%221%22%20fill%3D%22%238a8f98%22%2F%3E%20%3C%21--%20wheels%20--%3E%20%3Crect%20x%3D%227%22%20y%3D%2214%22%20width%3D%222%22%20height%3D%222%22%20fill%3D%22%232b2f35%22%2F%3E%20%3Crect%20x%3D%2213%22%20y%3D%2214%22%20width%3D%222%22%20height%3D%222%22%20fill%3D%22%232b2f35%22%2F%3E%20%3Crect%20x%3D%226%22%20y%3D%2213%22%20width%3D%2210%22%20height%3D%221%22%20fill%3D%22%234a4f57%22%2F%3E%20%3C%2Fsvg%3E"); }
.mc-leaderboard { background-image: url("data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20width=%2220%22%20height=%2220%22%20viewBox=%220%200%2020%2020%22%20shape-rendering=%22crispEdges%22%3E%0A%20%20%3Crect%20width=%2220%22%20height=%2220%22%20fill=%22none%22/%3E%0A%20%20%3Crect%20x=%226%22%20y=%224%22%20width=%228%22%20height=%226%22%20fill=%22#f4d24d%22/%3E%0A%20%20%3Crect%20x=%225%22%20y=%225%22%20width=%221%22%20height=%224%22%20fill=%22#caa83c%22/%3E%0A%20%20%3Crect%20x=%2214%22%20y=%225%22%20width=%221%22%20height=%224%22%20fill=%22#caa83c%22/%3E%0A%20%20%3Crect%20x=%228%22%20y=%2210%22%20width=%224%22%20height=%223%22%20fill=%22#e2b93f%22/%3E%0A%20%20%3Crect%20x=%227%22%20y=%2213%22%20width=%226%22%20height=%222%22%20fill=%22#7a4f2a%22/%3E%0A%20%20%3Crect%20x=%226%22%20y=%2215%22%20width=%228%22%20height=%222%22%20fill=%22#5b3a20%22/%3E%0A%3C/svg%3E"); }
.mc-server { background-image: url("data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20width=%2220%22%20height=%2220%22%20viewBox=%220%200%2020%2020%22%20shape-rendering=%22crispEdges%22%3E%0A%20%20%3Crect%20width=%2220%22%20height=%2220%22%20fill=%22none%22/%3E%0A%20%20%3Crect%20x=%224%22%20y=%224%22%20width=%2212%22%20height=%225%22%20fill=%22#9aa2ad%22/%3E%0A%20%20%3Crect%20x=%224%22%20y=%2211%22%20width=%2212%22%20height=%225%22%20fill=%22#9aa2ad%22/%3E%0A%20%20%3Crect%20x=%226%22%20y=%226%22%20width=%222%22%20height=%221%22%20fill=%22#3bd16f%22/%3E%0A%20%20%3Crect%20x=%226%22%20y=%2213%22%20width=%222%22%20height=%221%22%20fill=%22#3bd16f%22/%3E%0A%20%20%3Crect%20x=%2210%22%20y=%226%22%20width=%224%22%20height=%221%22%20fill=%22#4a4f57%22/%3E%0A%20%20%3Crect%20x=%2210%22%20y=%2213%22%20width=%224%22%20height=%221%22%20fill=%22#4a4f57%22/%3E%0A%3C/svg%3E"); }
.mc-account { background-image: url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2220%22%20height%3D%2220%22%20viewBox%3D%220%200%2020%2020%22%20shape-rendering%3D%22crispEdges%22%3E%20%3Crect%20width%3D%2220%22%20height%3D%2220%22%20fill%3D%22none%22%2F%3E%20%3C%21--%20teeth%20--%3E%20%3Crect%20x%3D%229%22%20y%3D%222%22%20width%3D%222%22%20height%3D%223%22%20fill%3D%22%234a4f57%22%2F%3E%20%3Crect%20x%3D%229%22%20y%3D%2215%22%20width%3D%222%22%20height%3D%223%22%20fill%3D%22%234a4f57%22%2F%3E%20%3Crect%20x%3D%222%22%20y%3D%229%22%20width%3D%223%22%20height%3D%222%22%20fill%3D%22%234a4f57%22%2F%3E%20%3Crect%20x%3D%2215%22%20y%3D%229%22%20width%3D%223%22%20height%3D%222%22%20fill%3D%22%234a4f57%22%2F%3E%20%3Crect%20x%3D%224%22%20y%3D%224%22%20width%3D%222%22%20height%3D%222%22%20fill%3D%22%234a4f57%22%2F%3E%20%3Crect%20x%3D%2214%22%20y%3D%224%22%20width%3D%222%22%20height%3D%222%22%20fill%3D%22%234a4f57%22%2F%3E%20%3Crect%20x%3D%224%22%20y%3D%2214%22%20width%3D%222%22%20height%3D%222%22%20fill%3D%22%234a4f57%22%2F%3E%20%3Crect%20x%3D%2214%22%20y%3D%2214%22%20width%3D%222%22%20height%3D%222%22%20fill%3D%22%234a4f57%22%2F%3E%20%3C%21--%20body%20--%3E%20%3Crect%20x%3D%226%22%20y%3D%226%22%20width%3D%228%22%20height%3D%228%22%20fill%3D%22%23b8bec7%22%2F%3E%20%3Crect%20x%3D%226%22%20y%3D%226%22%20width%3D%228%22%20height%3D%221%22%20fill%3D%22%234a4f57%22%2F%3E%20%3Crect%20x%3D%226%22%20y%3D%2213%22%20width%3D%228%22%20height%3D%221%22%20fill%3D%22%234a4f57%22%2F%3E%20%3Crect%20x%3D%226%22%20y%3D%226%22%20width%3D%221%22%20height%3D%228%22%20fill%3D%22%234a4f57%22%2F%3E%20%3Crect%20x%3D%2213%22%20y%3D%226%22%20width%3D%221%22%20height%3D%228%22%20fill%3D%22%234a4f57%22%2F%3E%20%3C%21--%20inner%20ring%20--%3E%20%3Crect%20x%3D%228%22%20y%3D%228%22%20width%3D%224%22%20height%3D%224%22%20fill%3D%22%238a8f98%22%2F%3E%20%3C%21--%20hole%20--%3E%20%3Crect%20x%3D%229%22%20y%3D%229%22%20width%3D%222%22%20height%3D%222%22%20fill%3D%22%232b2f35%22%2F%3E%20%3C%2Fsvg%3E"); }
.mc-skin { background-image: url("data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20width=%2220%22%20height=%2220%22%20viewBox=%220%200%2020%2020%22%20shape-rendering=%22crispEdges%22%3E%0A%20%20%3Crect%20width=%2220%22%20height=%2220%22%20fill=%22none%22/%3E%0A%20%20%3Crect%20x=%224%22%20y=%225%22%20width=%2212%22%20height=%2210%22%20rx=%222%22%20ry=%222%22%20fill=%22#d9dde3%22/%3E%0A%20%20%3Crect%20x=%226%22%20y=%227%22%20width=%222%22%20height=%222%22%20fill=%22#ff5a5a%22/%3E%0A%20%20%3Crect%20x=%229%22%20y=%227%22%20width=%222%22%20height=%222%22%20fill=%22#5ac8ff%22/%3E%0A%20%20%3Crect%20x=%2212%22%20y=%227%22%20width=%222%22%20height=%222%22%20fill=%22#5aff8a%22/%3E%0A%20%20%3Crect%20x=%227%22%20y=%2211%22%20width=%222%22%20height=%222%22%20fill=%22#ffd85a%22/%3E%0A%20%20%3Crect%20x=%2210%22%20y=%2211%22%20width=%222%22%20height=%222%22%20fill=%22#b05aff%22/%3E%0A%3C/svg%3E"); }
.mc-logout { background-image: url("data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20width=%2220%22%20height=%2220%22%20viewBox=%220%200%2020%2020%22%20shape-rendering=%22crispEdges%22%3E%0A%20%20%3Crect%20width=%2220%22%20height=%2220%22%20fill=%22none%22/%3E%0A%20%20%3Crect%20x=%226%22%20y=%223%22%20width=%228%22%20height=%2214%22%20fill=%22#8b5a2b%22/%3E%0A%20%20%3Crect%20x=%227%22%20y=%224%22%20width=%226%22%20height=%2212%22%20fill=%22#a46b35%22/%3E%0A%20%20%3Crect%20x=%2212%22%20y=%2210%22%20width=%221%22%20height=%221%22%20fill=%22#2b2f35%22/%3E%0A%3C/svg%3E"); }
/* ===== /MC icons for sidebar (v5) ===== */

/* ===== Torch nav item alignment fixes (v5) ===== */
.nav-item.torch-item{
  display:flex;
  align-items:center;
}
.nav-item.torch-item .torch-toggle{
  margin-right:15px; /* match .nav-item i */
  width:20px;
  height:20px;
  display:flex;
  align-items:center;
  justify-content:center;
  flex: 0 0 auto;
}
.nav-item.torch-item .torch-container.mini{
  transform: scale(0.12); /* keep tiny torch */
  transform-origin: left center;
}
/* ===== /Torch nav item alignment fixes (v5) ===== */

/* ===== Extra dark theme fixes (v5) ===== */
body.theme-dark .sidebar{
  background: linear-gradient(180deg,#131722 0%, #0f1115 100%);
}
body.theme-dark .sidebar-header h2,
body.theme-dark .sidebar-header p{
  color:#e9e9ea;
}

body.theme-dark .header{
  background:#151a23;
  border-bottom:1px solid rgba(255,255,255,0.08);
}
body.theme-dark .page-title{ color:#e9e9ea; }
body.theme-dark .user-info{ color:#e9e9ea; }
body.theme-dark .user-name,
body.theme-dark #user-name,
body.theme-dark #user-role{ color:#e9e9ea; }
body.theme-dark .user-avatar{ background:#0f1115; border:1px solid rgba(255,255,255,0.10); }

body.theme-dark .notification{
  background:#151a23;
  color:#e9e9ea;
  border:1px solid rgba(255,255,255,0.10);
  box-shadow: 0 10px 25px rgba(0,0,0,0.45);
}
body.theme-dark .notification a{ color:#8ecbff; }

body.theme-dark .login-container{
            background:
              radial-gradient(circle at top left, rgba(0,204,102,0.18), transparent 55%),
              radial-gradient(circle at bottom right, rgba(26,115,232,0.18), transparent 55%),
              linear-gradient(to bottom, rgba(0,0,0,.55), rgba(0,0,0,.78)),
              url('images/hbg.webp');
            background-size: cover;
            background-position: center;
        }
body.theme-dark .login-logo h1{ color:#e9e9ea; }
body.theme-dark .login-logo p{ color: rgba(233,233,234,0.75); }
body.theme-dark .login-form label{ color:#e9e9ea; }
body.theme-dark .login-form input,
body.theme-dark .login-form select{
  background:#0f1115;
  color:#e9e9ea;
  border:1px solid rgba(255,255,255,0.10);
}
body.theme-dark .login-form input::placeholder{ color: rgba(233,233,234,0.55); }

body.theme-dark #calendar-container{
  background: transparent;
}
body.theme-dark .calendar-day{
  background:#0f1115;
  color:#e9e9ea;
  border:1px solid rgba(255,255,255,0.08);
}
body.theme-dark .calendar-day:hover{
  background: rgba(255,255,255,0.06);
}
body.theme-dark .calendar-day.disabled{
  background:#0b0d11;
  color: rgba(233,233,234,0.35);
}
body.theme-dark .calendar-day.other-month{
  color: rgba(233,233,234,0.35);
}

body.theme-dark .sign-rewards h3,
body.theme-dark .sign-rewards p,
body.theme-dark .points-explanation,
body.theme-dark .points-explanation p,
body.theme-dark .points-explanation strong{
  color:#e9e9ea;
}
body.theme-dark .points-explanation .highlight{
  color:#8ecbff;
}
body.theme-dark .points-table table{
  background:#151a23;
  color:#e9e9ea;
}
body.theme-dark .points-table th{
  background:#0f1115;
  color:#e9e9ea;
}
body.theme-dark .points-table td{
  border-color: rgba(255,255,255,0.08);
}
body.theme-dark .points-table caption{
  color: rgba(233,233,234,0.75);
}

body.theme-dark #leaderboard-table,
body.theme-dark .leaderboard-table,
body.theme-dark .leaderboard-table table{
  background:#151a23;
  color:#e9e9ea;
}
body.theme-dark .leaderboard-table th{
  background:#0f1115;
  color:#e9e9ea;
}
body.theme-dark .leaderboard-table td{
  border-color: rgba(255,255,255,0.08);
}
body.theme-dark .leaderboard-table tr:hover{
  background: rgba(255,255,255,0.04);
}

body.theme-dark .server-loading{
  background: rgba(15,17,21,0.85);
}
body.theme-dark .server-loading .loading-text{
  color:#e9e9ea;
}

body.theme-dark .info-card{
  background:#151a23;
  color:#e9e9ea;
  border:1px solid rgba(255,255,255,0.10);
}
body.theme-dark .info-title{ color: rgba(233,233,234,0.75); }
body.theme-dark .info-value{ color:#e9e9ea; }
body.theme-dark .info-card input,
body.theme-dark .info-card select{
  background:#0f1115;
  color:#e9e9ea;
  border:1px solid rgba(255,255,255,0.10);
}
/* ===== /Extra dark theme fixes (v5) ===== */



/* ===== Fix: MC icons data-uri encoding (v6) ===== */
.nav-item .mc-icon {
  margin-right: 15px;
  width: 20px;
  height: 20px;
  display: inline-block;
  background-size: contain;
  background-repeat: no-repeat;
  background-position: center;
  image-rendering: pixelated;
  flex: 0 0 auto;
}
.mc-user { background-image: url("data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20width=%2220%22%20height=%2220%22%20viewBox=%220%200%2020%2020%22%20shape-rendering=%22crispEdges%22%3E%0A%20%20%3Crect%20width=%2220%22%20height=%2220%22%20fill=%22%236fb1e6%22/%3E%0A%20%20%3Crect%20x=%223%22%20y=%223%22%20width=%2214%22%20height=%2214%22%20fill=%22%23c68642%22/%3E%0A%20%20%3Crect%20x=%223%22%20y=%223%22%20width=%2214%22%20height=%225%22%20fill=%22%233b2b20%22/%3E%0A%20%20%3Crect%20x=%226%22%20y=%229%22%20width=%223%22%20height=%223%22%20fill=%22%232b5aa6%22/%3E%0A%20%20%3Crect%20x=%2211%22%20y=%229%22%20width=%223%22%20height=%223%22%20fill=%22%232b5aa6%22/%3E%0A%20%20%3Crect%20x=%228%22%20y=%2213%22%20width=%224%22%20height=%222%22%20fill=%22%238b5a2b%22/%3E%0A%3C/svg%3E"); }
.mc-sign { background-image: url("data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20width=%2220%22%20height=%2220%22%20viewBox=%220%200%2020%2020%22%20shape-rendering=%22crispEdges%22%3E%0A%20%20%3Crect%20width=%2220%22%20height=%2220%22%20fill=%22none%22/%3E%0A%20%20%3Crect%20x=%223%22%20y=%224%22%20width=%2214%22%20height=%2213%22%20fill=%22%23d9dde3%22/%3E%0A%20%20%3Crect%20x=%223%22%20y=%224%22%20width=%2214%22%20height=%224%22%20fill=%22%23c84c4c%22/%3E%0A%20%20%3Crect%20x=%226%22%20y=%222%22%20width=%222%22%20height=%224%22%20fill=%22%236b6f76%22/%3E%0A%20%20%3Crect%20x=%2212%22%20y=%222%22%20width=%222%22%20height=%224%22%20fill=%22%236b6f76%22/%3E%0A%20%20%3Crect%20x=%225%22%20y=%2210%22%20width=%223%22%20height=%223%22%20fill=%22%238fbf6a%22/%3E%0A%20%20%3Crect%20x=%229%22%20y=%2210%22%20width=%223%22%20height=%223%22%20fill=%22%238fbf6a%22/%3E%0A%20%20%3Crect%20x=%2213%22%20y=%2210%22%20width=%222%22%20height=%223%22%20fill=%22%238fbf6a%22/%3E%0A%3C/svg%3E"); }
.mc-shop { background-image: url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2220%22%20height%3D%2220%22%20viewBox%3D%220%200%2020%2020%22%20shape-rendering%3D%22crispEdges%22%3E%20%3Crect%20width%3D%2220%22%20height%3D%2220%22%20fill%3D%22none%22%2F%3E%20%3C%21--%20handle%20--%3E%20%3Crect%20x%3D%224%22%20y%3D%224%22%20width%3D%222%22%20height%3D%221%22%20fill%3D%22%234a4f57%22%2F%3E%20%3Crect%20x%3D%223%22%20y%3D%225%22%20width%3D%221%22%20height%3D%223%22%20fill%3D%22%234a4f57%22%2F%3E%20%3C%21--%20basket%20outline%20--%3E%20%3Crect%20x%3D%225%22%20y%3D%226%22%20width%3D%2211%22%20height%3D%221%22%20fill%3D%22%234a4f57%22%2F%3E%20%3Crect%20x%3D%225%22%20y%3D%227%22%20width%3D%221%22%20height%3D%226%22%20fill%3D%22%234a4f57%22%2F%3E%20%3Crect%20x%3D%2215%22%20y%3D%227%22%20width%3D%221%22%20height%3D%226%22%20fill%3D%22%234a4f57%22%2F%3E%20%3Crect%20x%3D%226%22%20y%3D%2212%22%20width%3D%229%22%20height%3D%221%22%20fill%3D%22%234a4f57%22%2F%3E%20%3C%21--%20basket%20fill%20--%3E%20%3Crect%20x%3D%226%22%20y%3D%227%22%20width%3D%229%22%20height%3D%225%22%20fill%3D%22%23b8bec7%22%2F%3E%20%3Crect%20x%3D%226%22%20y%3D%229%22%20width%3D%229%22%20height%3D%221%22%20fill%3D%22%238a8f98%22%2F%3E%20%3C%21--%20wheels%20--%3E%20%3Crect%20x%3D%227%22%20y%3D%2214%22%20width%3D%222%22%20height%3D%222%22%20fill%3D%22%232b2f35%22%2F%3E%20%3Crect%20x%3D%2213%22%20y%3D%2214%22%20width%3D%222%22%20height%3D%222%22%20fill%3D%22%232b2f35%22%2F%3E%20%3Crect%20x%3D%226%22%20y%3D%2213%22%20width%3D%2210%22%20height%3D%221%22%20fill%3D%22%234a4f57%22%2F%3E%20%3C%2Fsvg%3E"); }
.mc-leaderboard { background-image: url("data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20width=%2220%22%20height=%2220%22%20viewBox=%220%200%2020%2020%22%20shape-rendering=%22crispEdges%22%3E%0A%20%20%3Crect%20width=%2220%22%20height=%2220%22%20fill=%22none%22/%3E%0A%20%20%3Crect%20x=%226%22%20y=%224%22%20width=%228%22%20height=%226%22%20fill=%22%23f4d24d%22/%3E%0A%20%20%3Crect%20x=%225%22%20y=%225%22%20width=%221%22%20height=%224%22%20fill=%22%23caa83c%22/%3E%0A%20%20%3Crect%20x=%2214%22%20y=%225%22%20width=%221%22%20height=%224%22%20fill=%22%23caa83c%22/%3E%0A%20%20%3Crect%20x=%228%22%20y=%2210%22%20width=%224%22%20height=%223%22%20fill=%22%23e2b93f%22/%3E%0A%20%20%3Crect%20x=%227%22%20y=%2213%22%20width=%226%22%20height=%222%22%20fill=%22%237a4f2a%22/%3E%0A%20%20%3Crect%20x=%226%22%20y=%2215%22%20width=%228%22%20height=%222%22%20fill=%22%235b3a20%22/%3E%0A%3C/svg%3E"); }
.mc-server { background-image: url("data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20width=%2220%22%20height=%2220%22%20viewBox=%220%200%2020%2020%22%20shape-rendering=%22crispEdges%22%3E%0A%20%20%3Crect%20width=%2220%22%20height=%2220%22%20fill=%22none%22/%3E%0A%20%20%3Crect%20x=%224%22%20y=%224%22%20width=%2212%22%20height=%225%22%20fill=%22%239aa2ad%22/%3E%0A%20%20%3Crect%20x=%224%22%20y=%2211%22%20width=%2212%22%20height=%225%22%20fill=%22%239aa2ad%22/%3E%0A%20%20%3Crect%20x=%226%22%20y=%226%22%20width=%222%22%20height=%221%22%20fill=%22%233bd16f%22/%3E%0A%20%20%3Crect%20x=%226%22%20y=%2213%22%20width=%222%22%20height=%221%22%20fill=%22%233bd16f%22/%3E%0A%20%20%3Crect%20x=%2210%22%20y=%226%22%20width=%224%22%20height=%221%22%20fill=%22%234a4f57%22/%3E%0A%20%20%3Crect%20x=%2210%22%20y=%2213%22%20width=%224%22%20height=%221%22%20fill=%22%234a4f57%22/%3E%0A%3C/svg%3E"); }
.mc-account { background-image: url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2220%22%20height%3D%2220%22%20viewBox%3D%220%200%2020%2020%22%20shape-rendering%3D%22crispEdges%22%3E%20%3Crect%20width%3D%2220%22%20height%3D%2220%22%20fill%3D%22none%22%2F%3E%20%3C%21--%20teeth%20--%3E%20%3Crect%20x%3D%229%22%20y%3D%222%22%20width%3D%222%22%20height%3D%223%22%20fill%3D%22%234a4f57%22%2F%3E%20%3Crect%20x%3D%229%22%20y%3D%2215%22%20width%3D%222%22%20height%3D%223%22%20fill%3D%22%234a4f57%22%2F%3E%20%3Crect%20x%3D%222%22%20y%3D%229%22%20width%3D%223%22%20height%3D%222%22%20fill%3D%22%234a4f57%22%2F%3E%20%3Crect%20x%3D%2215%22%20y%3D%229%22%20width%3D%223%22%20height%3D%222%22%20fill%3D%22%234a4f57%22%2F%3E%20%3Crect%20x%3D%224%22%20y%3D%224%22%20width%3D%222%22%20height%3D%222%22%20fill%3D%22%234a4f57%22%2F%3E%20%3Crect%20x%3D%2214%22%20y%3D%224%22%20width%3D%222%22%20height%3D%222%22%20fill%3D%22%234a4f57%22%2F%3E%20%3Crect%20x%3D%224%22%20y%3D%2214%22%20width%3D%222%22%20height%3D%222%22%20fill%3D%22%234a4f57%22%2F%3E%20%3Crect%20x%3D%2214%22%20y%3D%2214%22%20width%3D%222%22%20height%3D%222%22%20fill%3D%22%234a4f57%22%2F%3E%20%3C%21--%20body%20--%3E%20%3Crect%20x%3D%226%22%20y%3D%226%22%20width%3D%228%22%20height%3D%228%22%20fill%3D%22%23b8bec7%22%2F%3E%20%3Crect%20x%3D%226%22%20y%3D%226%22%20width%3D%228%22%20height%3D%221%22%20fill%3D%22%234a4f57%22%2F%3E%20%3Crect%20x%3D%226%22%20y%3D%2213%22%20width%3D%228%22%20height%3D%221%22%20fill%3D%22%234a4f57%22%2F%3E%20%3Crect%20x%3D%226%22%20y%3D%226%22%20width%3D%221%22%20height%3D%228%22%20fill%3D%22%234a4f57%22%2F%3E%20%3Crect%20x%3D%2213%22%20y%3D%226%22%20width%3D%221%22%20height%3D%228%22%20fill%3D%22%234a4f57%22%2F%3E%20%3C%21--%20inner%20ring%20--%3E%20%3Crect%20x%3D%228%22%20y%3D%228%22%20width%3D%224%22%20height%3D%224%22%20fill%3D%22%238a8f98%22%2F%3E%20%3C%21--%20hole%20--%3E%20%3Crect%20x%3D%229%22%20y%3D%229%22%20width%3D%222%22%20height%3D%222%22%20fill%3D%22%232b2f35%22%2F%3E%20%3C%2Fsvg%3E"); }
.mc-skin { background-image: url("data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20width=%2220%22%20height=%2220%22%20viewBox=%220%200%2020%2020%22%20shape-rendering=%22crispEdges%22%3E%0A%20%20%3Crect%20width=%2220%22%20height=%2220%22%20fill=%22none%22/%3E%0A%20%20%3Crect%20x=%224%22%20y=%225%22%20width=%2212%22%20height=%2210%22%20rx=%222%22%20ry=%222%22%20fill=%22%23d9dde3%22/%3E%0A%20%20%3Crect%20x=%226%22%20y=%227%22%20width=%222%22%20height=%222%22%20fill=%22%23ff5a5a%22/%3E%0A%20%20%3Crect%20x=%229%22%20y=%227%22%20width=%222%22%20height=%222%22%20fill=%22%235ac8ff%22/%3E%0A%20%20%3Crect%20x=%2212%22%20y=%227%22%20width=%222%22%20height=%222%22%20fill=%22%235aff8a%22/%3E%0A%20%20%3Crect%20x=%227%22%20y=%2211%22%20width=%222%22%20height=%222%22%20fill=%22%23ffd85a%22/%3E%0A%20%20%3Crect%20x=%2210%22%20y=%2211%22%20width=%222%22%20height=%222%22%20fill=%22%23b05aff%22/%3E%0A%3C/svg%3E"); }
.mc-logout { background-image: url("data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20width=%2220%22%20height=%2220%22%20viewBox=%220%200%2020%2020%22%20shape-rendering=%22crispEdges%22%3E%0A%20%20%3Crect%20width=%2220%22%20height=%2220%22%20fill=%22none%22/%3E%0A%20%20%3Crect%20x=%226%22%20y=%223%22%20width=%228%22%20height=%2214%22%20fill=%22%238b5a2b%22/%3E%0A%20%20%3Crect%20x=%227%22%20y=%224%22%20width=%226%22%20height=%2212%22%20fill=%22%23a46b35%22/%3E%0A%20%20%3Crect%20x=%2212%22%20y=%2210%22%20width=%221%22%20height=%221%22%20fill=%22%232b2f35%22/%3E%0A%3C/svg%3E"); }
/* ===== /Fix: MC icons data-uri encoding (v6) ===== */

/* ===== Calendar: distinguish signed/unsigned (v6) ===== */
.calendar-day.unsigned {
  background-color: rgba(231, 76, 60, 0.16);
  color: #b02a2a;
  border: 1px solid rgba(231, 76, 60, 0.25);
}
.calendar-day.signed {
  background-color: #2ecc71;
  color: #ffffff;
}
body.theme-dark .calendar-day.signed {
  background-color: #2ecc71;
  color: #0f1115;
  border-color: rgba(46, 204, 113, 0.55);
}
body.theme-dark .calendar-day.unsigned {
  background-color: rgba(231, 76, 60, 0.22);
  color: #ffb3b3;
  border-color: rgba(231, 76, 60, 0.35);
}
/* ===== /Calendar: distinguish signed/unsigned (v6) ===== */

/* ===== Dark theme: cards + sign tables + captions (v6) ===== */
body.theme-dark .content-card {
  background: #151a23;
  color: #e9e9ea;
  border: 1px solid rgba(255,255,255,0.10);
  box-shadow: 0 10px 30px rgba(0,0,0,0.35);
}
body.theme-dark .card-header {
  border-bottom: 1px solid rgba(255,255,255,0.08);
}
body.theme-dark .card-header h2 {
  color: #e9e9ea;
}
body.theme-dark .action-button {
  color: #e9e9ea;
}

body.theme-dark .points-table caption {
  background: #0f1115;
  color: #e9e9ea;
}
body.theme-dark .points-table tfoot td {
  background: #0f1115;
  color: #8ecbff;
}
/* ===== /Dark theme: cards + sign tables + captions (v6) ===== */

/* ===== Light theme: login gradient to match dark vibe (v6) ===== */
body.theme-light .login-container {
  background:
    radial-gradient(1200px 600px at 10% 10%, rgba(52,152,219,0.22), transparent 60%),
    radial-gradient(900px 500px at 90% 20%, rgba(231,76,60,0.14), transparent 60%),
    linear-gradient(180deg, rgba(246,251,255,.90) 0%, rgba(255,255,255,.92) 55%, rgba(247,249,255,.90) 100%),
    url('images/hbg.webp');
  background-size: cover;
  background-position: center;
}
/* ===== /Light theme: login gradient to match dark vibe (v6) ===== */



/* ===== Patch: dark theme points tips + torch alignment + light login gradient (v7) ===== */

/* 1) Points tips (计算说明) dark theme */
body.theme-dark .points-tips{
  background:#151a23;
  color:#e9e9ea;
  border-left-color: var(--warning-color);
  border: 1px solid rgba(255,255,255,0.10);
}
body.theme-dark .points-tips p,
body.theme-dark .points-tips li{
  color:#e9e9ea;
}
body.theme-dark .points-tips i{
  color: var(--warning-color);
}
body.theme-dark .points-tips strong{
  color:#8ecbff;
}

/* 2) Torch nav item alignment – match other sidebar items */
.nav-item.torch-item{
  justify-content: flex-start !important;
  gap: 0 !important;
  align-items: center !important;
}
.nav-item.torch-item .torch-toggle{
  margin-right: 15px !important;   /* same as .nav-item i / .mc-icon */
  width: 20px !important;
  height: 20px !important;
  flex: 0 0 20px !important;
  display:flex !important;
  align-items:center !important;
  justify-content:center !important;
}
.nav-item.torch-item .torch-container.mini{
  transform: scale(0.12) !important;
  transform-origin: center center !important;
}
.nav-item.torch-item .nav-text{
  line-height: 20px;
}

/* 3) Light theme login: blue-white gradient */
body.theme-light .login-container{
            background:
              radial-gradient(1000px 600px at 50% 20%, rgba(82,100,174,.18), transparent 55%),
              linear-gradient(135deg, rgba(215,236,255,.92) 0%, rgba(255,255,255,.92) 45%, rgba(215,236,255,.92) 100%),
              url('images/hbg.webp');
            background-size: cover;
            background-position: center;
        }
body.theme-dark .server-button:hover{
  background: var(--primary-color);
  color: #ffffff;
}
body.theme-dark .server-button.primary{
  background: var(--primary-color);
  color: #ffffff;
  border: none;
}
body.theme-dark .server-button.danger{
  background: var(--accent-color);
  color: #ffffff;
  border: none;
}
body.theme-dark .server-button.disabled,
body.theme-dark .server-button:disabled{
  background: rgba(255,255,255,0.12) !important;
  color: rgba(233,233,234,0.55) !important;
  border-color: rgba(255,255,255,0.10) !important;
  cursor: not-allowed !important;
}
/* ===== /Patch v8 ===== */



/* ===== Floating label input style (From Uiverse.io by dovatgabriel) ===== */
.group {
  position: relative;
  margin-bottom: 22px;
}
.group .input {
  font-size: 15px;
  padding: 14px 12px 14px 12px;
  display: block;
  width: 100%;
  box-sizing: border-box;
  border: none;
  border-bottom: 1px solid #515151;
  background: transparent;
  border-radius: 10px;
  min-height: 48px;
}
.group .input:focus { outline: none; }

.group label {
  color: #999;
  font-size: 16px;
  font-weight: normal;
  position: absolute;
  pointer-events: none;
  left: 12px;
  top: 14px;
  transition: 0.2s ease all;
}

.group .input:focus ~ label,
.group .input:not(:placeholder-shown) ~ label {
  top: -18px;
  font-size: 13px;
  color: #5264AE;
}

.group .bar {
  position: relative;
  display: block;
  width: 100%;
}

.group .bar:before,
.group .bar:after {
  content: '';
  height: 2px;
  width: 0;
  bottom: 1px;
  position: absolute;
  background: #5264AE;
  transition: 0.2s ease all;
}

.group .bar:before { left: 50%; }
.group .bar:after  { right: 50%; }

.group .input:focus ~ .bar:before,
.group .input:focus ~ .bar:after {
  width: 50%;
}

.group .highlight {
  position: absolute;
  height: 60%;
  width: 100px;
  top: 25%;
  left: 0;
  pointer-events: none;
  opacity: 0.5;
}

.group .input:focus ~ .highlight {
  animation: inputHighlighter 0.3s ease;
}

@keyframes inputHighlighter {
  from { background: #5264AE; }
  to   { width: 0; background: transparent; }
}

/* Keep layout hints without showing placeholder text */
.group .input::placeholder { color: transparent; }
.group .input:focus::placeholder { color: #aaa; }

/* Bundle / inline fields layout */
.bundle-item {
  display: flex;
  gap: 12px;
  align-items: flex-end;
  flex-wrap: wrap;
}
.bundle-item .bundle-field {
  flex: 1 1 160px;
  min-width: 160px;
  margin-bottom: 0;
}

/* Dark theme compatibility */
body.theme-dark .group .input {
  background: transparent !important;
  border-bottom: 1px solid rgba(233,233,234,0.35) !important;
}
body.theme-dark .group label { color: rgba(233,233,234,0.75); }
body.theme-dark .group .input:focus ~ label,
body.theme-dark .group .input:not(:placeholder-shown) ~ label {
  color: #8ab4ff;
}
body.theme-dark .group .bar:before,
body.theme-dark .group .bar:after {
  background: #8ab4ff;
}
/* ===== /Floating label input style ===== */
</style>
</head>
<body class="loading">
<div id="page-splash">
<div aria-label="Loading" class="honeycomb" role="status">
<div></div><div></div><div></div><div></div><div></div><div></div><div></div>
</div>
</div>
<div id="app">
<!-- 通知区域 -->
<div class="notification" id="notification"></div>
<!-- 加载动画 -->
<div class="loading-overlay" id="loading-overlay">
<div aria-label="Loading" class="honeycomb" role="status">
<div></div><div></div><div></div><div></div><div></div><div></div><div></div>
</div>
</div>
<!-- 登录界面 -->
<div class="login-container" id="login-page">
<div class="login-card">
<div class="login-logo">
<h1>嘎嘣脆の小服</h1>
<p>综合管理系统</p>
</div>
<div class="login-form">
<div class="group"><input class="input" id="login-username" onkeypress="return event.key !== '@'" placeholder=" " title="请输入用户名" type="text"/><span class="highlight"></span><span class="bar"></span><label for="login-username">用户名</label></div>
<div class="group"><input class="input" id="login-password" placeholder=" " title="请输入密码" type="password"/><span class="highlight"></span><span class="bar"></span><label for="login-password">密码</label></div>
<div class="group admin-login-section" id="admin-login-section" style="display:none"><input class="input" id="login-totp" placeholder=" " title="请输入TOTP验证码" type="text"/><span class="highlight"></span><span class="bar"></span><label for="login-totp">TOTP验证码</label></div>
<div class="login-options">
<div class="remember-me">
<input id="remember" type="checkbox"/>
<label for="remember">记住我</label>
</div>
<a class="forgot-password" href="#" onclick="openModal('forgot')">忘记密码？</a>
</div>
<button class="login-button" id="player-login-btn" onclick="login('player')">玩家登录</button>
<button class="login-button admin-login-button" id="admin-toggle-btn" onclick="toggleAdminLogin()">管理员登录</button>
<div class="register-link">
                    没有账号？<a href="#" onclick="openModal('register')">立即注册</a>
</div>
</div>
</div>
</div>
<!-- 注册/忘记密码弹窗 -->
<div class="modal" id="auth-modal">
<div class="modal-content">
<span class="close-button" onclick="closeModal()">×</span>
<div class="modal-header">
<h2 id="modal-title">注册新账号</h2>
</div>
<div class="modal-tabs">
<div class="modal-tab" id="register-tab" onclick="switchAuthTab('register')">注册</div>
<div class="modal-tab" id="forgot-tab" onclick="switchAuthTab('forgot')">忘记密码</div>
</div>
<div class="modal-body">
<!-- 注册表单 -->
<div class="auth-form" id="register-form">
<div class="group"><input class="input" id="reg-username" oninput="validateInput(this, true)" placeholder=" " title="请输入用户名" type="text"/><span class="highlight"></span><span class="bar"></span><label for="reg-username">用户名</label></div>
<div class="group"><input class="input" id="reg-password" oninput="validateInput(this)" placeholder=" " title="请输入密码" type="password"/><span class="highlight"></span><span class="bar"></span><label for="reg-password">密码</label></div>
<div class="group"><input class="input" id="reg-email" placeholder=" " title="请输入邮箱" type="email"/><span class="highlight"></span><span class="bar"></span><label for="reg-email">邮箱</label></div>
<button class="login-button" onclick="register()">注册</button>
</div>
<!-- 忘记密码表单 -->
<div class="auth-form" id="forgot-form" style="display:none">
<div class="group"><input class="input" id="forgot-username" placeholder=" " title="请输入用户名" type="text"/><span class="highlight"></span><span class="bar"></span><label for="forgot-username">用户名</label></div>
<div class="group"><input class="input" id="forgot-email" placeholder=" " title="请输入注册邮箱" type="email"/><span class="highlight"></span><span class="bar"></span><label for="forgot-email">邮箱</label></div>
<div class="group"><input class="input" id="forgot-password" placeholder=" " title="请输入新密码" type="password"/><span class="highlight"></span><span class="bar"></span><label for="forgot-password">新密码</label></div>
<button class="login-button" onclick="resetPassword()">重置密码</button>
</div>
<!-- 验证码表单 -->
<div class="auth-form" id="verification-form" style="display:none">
<div class="group"><input class="input" id="verification-code" placeholder=" " title="请输入6位验证码" type="text"/><span class="highlight"></span><span class="bar"></span><label for="verification-code">验证码</label></div>
<div class="countdown" id="verification-countdown">验证码有效时间：05:00</div>
<button class="login-button" id="verify-button" onclick="verifyCode()">验证</button>
</div>
</div>
<div class="modal-footer">
<button class="server-button" onclick="closeModal()">取消</button>
</div>
</div>
</div>
<!-- 主系统界面 -->
<div class="main-system" id="main-system">
<!-- 左侧导航栏 -->
<div class="sidebar">
<div class="sidebar-header">
<h2>嘎嘣脆の小服</h2>
<p>综合管理系统</p>
</div>
<div class="nav-item active" data-page="user-center" onclick="switchPage('user-center')">
<span aria-hidden="true" class="mc-icon mc-user"></span>
<span class="nav-text">用户中心</span>
</div>
<div class="nav-item admin-only-hidden" data-page="sign-page" onclick="switchPage('sign-page')">
<span aria-hidden="true" class="mc-icon mc-sign"></span>
<span class="nav-text">签到系统</span>
</div>
<div class="nav-item" data-page="shop" onclick="switchPage('shop')">
<span aria-hidden="true" class="mc-icon mc-shop"></span>
<span class="nav-text">积分商城</span>
</div>
<div class="nav-item admin-only-hidden" data-page="leaderboard" onclick="switchPage('leaderboard')">
<span aria-hidden="true" class="mc-icon mc-leaderboard"></span>
<span class="nav-text">排行榜</span>
</div>
<div class="nav-item" data-page="server-status" onclick="switchPage('server-status')">
<span aria-hidden="true" class="mc-icon mc-server"></span>
<span class="nav-text">服务器状态</span>
</div>
<div class="nav-divider"></div>
<div class="nav-item admin-only-hidden" data-page="account" onclick="switchPage('account')">
<span aria-hidden="true" class="mc-icon mc-account"></span>
<span class="nav-text">账户设置</span>
</div>
<div class="nav-item" data-page="support" onclick="switchPage('support')">
<span aria-hidden="true" class="mc-icon mc-skin"></span>
<span class="nav-text">LittleSkin皮肤站</span> <!-- 修改文本 -->
</div>
<div class="nav-item torch-item" id="theme-toggle-item" role="button" tabindex="0" title="切换明暗主题">
<div class="torch-toggle">
<label aria-label="切换明暗主题" class="torch-container mini">
<input id="theme-toggle-checkbox" type="checkbox">
<div class="torch">
<div class="head">
<div class="face top"><div></div><div></div><div></div><div></div></div>
<div class="face left"><div></div><div></div><div></div><div></div></div>
<div class="face right"><div></div><div></div><div></div><div></div></div>
</div>
<div class="stick">
<div class="side side-left">
<div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div>
<div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div>
</div>
<div class="side side-right">
<div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div>
<div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div>
</div>
</div>
</div>
</input></label>
</div><span class="nav-text">火把</span>
</div>
<div class="nav-divider"></div>
<div class="nav-item" onclick="logout()">
<span aria-hidden="true" class="mc-icon mc-logout"></span>
<span class="nav-text">退出登录</span>
</div>
</div>
<!-- 主内容区域 -->
<div class="main-content">
<!-- 头部区域 -->
<div class="header">
<h1 class="page-title" id="page-title">用户中心</h1>
<div class="user-info">
<div class="user-avatar">
<img alt="用户头像" id="user-avatar-img" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='40' r='20' fill='%233498db'/%3E%3Ccircle cx='50' cy='100' r='40' fill='%233498db'/%3E%3C/svg%3E"/>
</div>
<div class="user-details">
<div class="user-name" id="username-display">管理员</div>
<div class="user-status" id="user-status">在线</div>
</div>
</div>
</div>
<!-- 用户中心页面 -->
<div class="page-content" id="user-center">
<div class="content-card">
<div class="card-header">
<h2 id="user-center-title">白名单管理</h2>
</div>
<div class="server-grid" id="user-center-content">
<!-- 修改服务器状态卡片 -->
<div class="server-card admin-only-hidden" id="player-server-status">
<div class="server-header">
<div class="server-name">服务器登录状态</div>
<div class="server-status" id="server-status-container">
<i class="fas fa-circle" id="server-status-icon"></i>
<span id="server-status-text">未登录</span>
</div>
</div>
<div class="server-info">
<div class="server-address">账号: <span id="server-account">未登录</span></div>
<div class="server-stats">
<div class="stat-item">
<span class="stat-label">在线时长</span>
<span class="stat-value" id="online-time">0小时</span>
</div>
<div class="stat-item">
<span class="stat-label">最后登录</span>
<span class="stat-value" id="last-login">从未登录</span>
</div>
</div>
</div>
<div class="server-actions" id="server-action-buttons">
<button class="server-button" id="server-login-btn">登录服务器</button>
<button class="server-button" id="server-logout-btn">退出服务器</button>
</div>
</div>
<!-- 管理员界面：用户管理表格 -->
<div class="user-management" id="admin-user-management" style="display:none">
<table class="user-table">
<thead>
<tr>
<th>用户名</th>
<th>邮箱</th>
<th>状态</th>
<th>注册日期</th>
<th>最后登录</th>
<th>在线时长</th>
<th>操作</th>
</tr>
</thead>
<tbody id="user-table-body">
<!-- 用户数据将通过JavaScript动态加载 -->
</tbody>
</table>
</div>
</div>
</div>
</div>
<!-- 服务器状态页面 -->
<div class="page-content" id="server-status" style="display:none">
<div class="content-card">
<div class="card-header">
<h2>服务器状态监控</h2>
<div class="actions">
<button class="action-button" onclick="refreshServerStatus()">刷新状态</button>
</div>
</div>
<div class="server-grid" id="server-status-grid">
</div>
</div>
</div>
<!-- 修改点1：在账户设置页面添加刷新按钮 -->
<div class="page-content" id="account" style="display:none">
<!-- 账户信息卡片 -->
<div class="content-card">
<div class="card-header">
<h2>账户设置</h2>
<div class="actions">
<button class="action-button" onclick="refreshAccountSettings()">
<i class="fas fa-sync-alt"></i> 刷新
                            </button>
</div>
</div>
<div class="account-grid">
<div class="avatar-section">
<div class="avatar-preview">
<img alt="头像预览" id="avatar-preview" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='150' height='150' viewBox='0 0 150 150'%3E%3Ccircle cx='75' cy='60' r='30' fill='%233498db'/%3E%3Ccircle cx='75' cy='150' r='60' fill='%233498db'/%3E%3C/svg%3E"/>
</div>
<div class="avatar-upload">
<label class="upload-button" for="avatar-input">
<i class="fas fa-upload"></i> 上传头像
                                </label>
<input accept="image/*" id="avatar-input" type="file"/>
</div>
<div class="account-info" id="account-info-section">
<div class="info-title">积分</div>
<div class="info-value" id="user-points">0</div>
</div>
</div>
<div class="account-details">
<div class="info-grid">
<div class="info-card">
<div class="info-title">用户名</div>
<div class="info-value" id="account-username">未登录</div>
</div>
<div class="info-card">
<div class="info-title">注册日期</div>
<div class="info-value" id="join-date">未注册</div>
</div>
<div class="info-card">
<div class="info-title">最后登录</div>
<div class="info-value" id="last-login-date">从未登录</div>
</div>
<div class="info-card">
<div class="info-title">在线时长</div>
<div class="info-value" id="online-time-total">0小时</div>
</div>
</div>
</div>
</div>
<div class="card-header">
<h2>安全设置</h2>
</div>
<div class="security-settings">
<div class="group"><input class="input" id="current-password" placeholder=" " title="请输入当前密码" type="password"/><span class="highlight"></span><span class="bar"></span><label for="current-password">当前密码</label></div>
<div class="group"><input class="input" id="new-password" placeholder=" " title="请输入新密码" type="password"/><span class="highlight"></span><span class="bar"></span><label for="new-password">新密码</label></div>
<div class="group"><input class="input" id="confirm-password" placeholder=" " title="请再次输入新密码" type="password"/><span class="highlight"></span><span class="bar"></span><label for="confirm-password">确认新密码</label></div>
<div class="info-actions">
<button class="action-button" id="save-password-btn" onclick="changePassword()">保存更改</button>
<button class="action-button secondary" onclick="clearPasswordFields()">取消</button>
</div>
</div>
</div>
</div>
<!-- 新增排行榜页面 -->
<div class="page-content admin-only-hidden" id="leaderboard" style="display:none">
<div class="content-card">
<div class="card-header">
<h2>玩家排行榜</h2>
<div class="actions">
<button class="action-button" onclick="refreshLeaderboard()">刷新</button>
</div>
</div>
<div class="leaderboard-table">
<table>
<thead>
<tr>
<th>排名</th>
<th>玩家</th>
<th>在线时长</th>
<th>最后登录</th>
<th>连签天数</th>
<th>总积分</th>
</tr>
</thead>
<tbody id="leaderboard-body">
<!-- 排行榜数据将通过JavaScript动态加载 -->
</tbody>
</table>
</div>
</div>
</div>
<!-- 在shop页面添加商品列表和兑换码管理 -->
<div class="page-content admin-only-hidden" id="shop" style="display:none">
<div class="content-card">
<div class="card-header">
<h2>积分商城</h2>
<div class="actions">
<button class="action-button admin-only" id="generate-coupon-btn" onclick="openCouponModal()">
<i class="fas fa-ticket-alt"></i> 生成兑换码
                            </button>
<button class="action-button admin-only" id="add-item-btn" onclick="openItemModal()">
<i class="fas fa-plus"></i> 添加商品
                            </button>
<button class="action-button" onclick="refreshShop()">
<i class="fas fa-sync-alt"></i> 刷新
                            </button>
</div>
</div>
<!-- 商品列表 -->
<div class="shop-grid" id="shop-items-grid"></div>
<!-- 兑换码管理 -->
<div id="coupon-management" style="display:none; margin-top: 30px;">
<h3>兑换码管理</h3>
<table class="user-table" id="coupons-table">
<thead>
<tr>
<th>兑换码</th>
<th>物品ID</th>
<th>所属玩家</th>
<th>有效期至</th>
<th>状态</th>
<th>操作</th>
</tr>
</thead>
<tbody id="coupons-body"></tbody>
</table>
</div>
</div>
<div class="modal" id="coupon-modal" style="display: none;">
<div class="modal-content" style="max-width: 500px; text-align: center;">
<span class="close-button" onclick="closeCouponModal()">×</span>
<h2>兑换成功！</h2>
<div class="coupon-details">
<p>物品: <span id="coupon-item-name"></span></p>
<p>兑换码: <span id="coupon-code" style="font-weight: bold; font-size: 1.2rem;"></span></p>
<p style="color: #e74c3c; margin: 15px 0;">请在3天内使用</p>
<button class="action-button" onclick="copyCouponCode()" style="margin: 10px auto;">
<i class="fas fa-copy"></i> 复制兑换码
                            </button>
</div>
</div>
</div>
<!-- 兑换码生成弹窗 -->
<div class="modal" id="generate-coupon-modal">
<div class="modal-content">
<span class="close-button" onclick="closeGenerateCouponModal()">×</span>
<div class="modal-header">
<h2>生成兑换码</h2>
</div>
<div class="modal-body">
<div class="input-group">
<label for="coupon-type">类型</label>
<select id="coupon-type" onchange="toggleCouponType()">
<option value="item">单个物品</option>
<option value="bundle">礼包（多个物品）</option>
</select>
</div>
<div class="input-group" id="coupon-item-group" style="display:none">
<label>物品</label>
<div class="bundle-item"><div class="group bundle-field"><input class="bundle-item-id input" id="coupon-item-id" placeholder=" " title="物品ID" type="text"/><span class="highlight"></span><span class="bar"></span><label for="coupon-item-id">物品ID</label></div><div class="group bundle-field"><input class="bundle-item-amount input" id="coupon-item-amount" min="1" placeholder=" " title="数量" type="number" value="1"/><span class="highlight"></span><span class="bar"></span><label for="coupon-item-amount">数量</label></div></div>
</div>
<div class="input-group" id="coupon-bundle-group" style="display:none">
<label>礼包物品</label>
<div id="bundle-items-container">
<div class="bundle-item"><div class="group bundle-field"><input class="bundle-item-id input" placeholder=" " title="物品ID" type="text"/><span class="highlight"></span><span class="bar"></span><label>物品ID</label></div><div class="group bundle-field"><input class="bundle-item-amount input" min="1" placeholder=" " title="数量" type="number" value="1"/><span class="highlight"></span><span class="bar"></span><label>数量</label></div><button onclick="removeBundleItem(this)" type="button">移除</button></div>
</div>
<button onclick="addBundleItem()" type="button">添加物品</button>
</div>
<div class="group"><input class="input" id="coupon-expires" placeholder=" " required="" type="date"/><span class="highlight"></span><span class="bar"></span><label for="coupon-expires">过期时间</label></div>
<div class="group"><input class="input" id="coupon-designated" placeholder=" " title="玩家用户名" type="text"/><span class="highlight"></span><span class="bar"></span><label for="coupon-designated">指定玩家（可选）</label></div>
<div class="input-group">
<label for="coupon-one-time">使用限制</label>
<select id="coupon-one-time">
<option value="true">一次性使用（所有玩家共用）</option>
<option value="false">每个玩家使用一次</option>
</select>
</div>
<button class="login-button" onclick="generateCoupon()">生成兑换码</button>
</div>
</div>
</div>
<!-- 添加商品弹窗 -->
<div class="modal" id="item-modal">
<div class="modal-content" style="max-width: 600px;">
<span class="close-button" onclick="closeItemModal()">×</span>
<div class="modal-header">
<h2 id="item-modal-title">添加商品</h2>
</div>
<div class="modal-body">
<div class="group"><input class="input" id="item-name" placeholder=" " title="输入商品名称" type="text"/><span class="highlight"></span><span class="bar"></span><label for="item-name">商品名称</label></div>
<div class="group"><input class="input" id="item-id" placeholder=" " title="例如: minecraft:diamond" type="text"/><span class="highlight"></span><span class="bar"></span><label for="item-id">物品ID</label></div>
<div class="group"><input class="input" id="item-amount" min="1" placeholder=" " title="输入物品数量" type="number" value="1"/><span class="highlight"></span><span class="bar"></span><label for="item-amount">物品数量</label></div>
<div class="group"><input class="input" id="item-points" placeholder=" " title="输入积分值" type="number"/><span class="highlight"></span><span class="bar"></span><label for="item-points">所需积分</label></div>
<div class="group"><input class="input" id="item-stock" placeholder=" " title="输入库存数量" type="number"/><span class="highlight"></span><span class="bar"></span><label for="item-stock">库存数量</label></div>
<div class="group"><input class="input" id="item-image" placeholder=" " title="输入图片URL" type="text"/><span class="highlight"></span><span class="bar"></span><label for="item-image">商品图片URL</label></div>
<div class="group"><textarea class="input" id="item-description" placeholder=" " rows="3" title="输入商品描述"></textarea><span class="highlight"></span><span class="bar"></span><label for="item-description">商品描述</label></div>
<button class="login-button" id="save-item-btn">保存商品</button>
</div>
</div>
</div>
</div>
<!-- 签到系统页面 -->
<div class="page-content admin-only-hidden" id="sign-page" style="display:none">
<div class="content-card">
<div class="card-header">
<h2>签到系统</h2>
<div class="actions">
<button class="action-button" id="sign-button" onclick="signIn()">立即签到</button>
</div>
</div>
<!-- 日历容器 -->
<div id="calendar-container">
<div class="calendar" id="calendar"></div>
</div>
<!-- 积分说明 -->
<div class="sign-rewards">
<h3>积分说明</h3>
<div class="points-explanation">
<p><strong>积分计算公式：</strong></p>
<p>每日积分 = <span class="highlight">10</span> + <span class="highlight">min(连签天数, 7) ×
                                    5</span></p>
<div class="points-table">
<table>
<caption>连续签到30天积分明细</caption>
<thead>
<tr>
<th>签到天数</th>
<th>连续天数</th>
<th>当日积分</th>
<th>累计积分</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>1</td>
<td>15</td>
<td>15</td>
</tr>
<tr>
<td>2</td>
<td>2</td>
<td>20</td>
<td>35</td>
</tr>
<tr>
<td>3</td>
<td>3</td>
<td>25</td>
<td>60</td>
</tr>
<tr>
<td>4</td>
<td>4</td>
<td>30</td>
<td>90</td>
</tr>
<tr>
<td>5</td>
<td>5</td>
<td>35</td>
<td>125</td>
</tr>
<tr>
<td>6</td>
<td>6</td>
<td>40</td>
<td>165</td>
</tr>
<tr>
<td>7</td>
<td>7</td>
<td>45</td>
<td>210</td>
</tr>
<tr>
<td>8</td>
<td>7</td>
<td>45</td>
<td>255</td>
</tr>
<tr>
<td>9</td>
<td>7</td>
<td>45</td>
<td>300</td>
</tr>
<tr>
<td>10</td>
<td>7</td>
<td>45</td>
<td>345</td>
</tr>
<tr>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="highlight-row">
<td>30</td>
<td>7</td>
<td>45</td>
<td><strong>1245</strong></td>
</tr>
</tbody>
<tfoot>
<tr>
<td colspan="4">
                                                计算公式：第1-7天累计210分 + 第8-30天(23天×45分=1035分) =
                                                <strong>1245分</strong>
</td>
</tr>
</tfoot>
</table>
<table>
<caption>中途断签示例（第15天断签）</caption>
<thead>
<tr>
<th>阶段</th>
<th>连续天数</th>
<th>天数</th>
<th>阶段积分</th>
<th>累计积分</th>
</tr>
</thead>
<tbody>
<tr>
<td>第1-14天</td>
<td>1→7</td>
<td>14</td>
<td>465</td>
<td>465</td>
</tr>
<tr>
<td>第15天</td>
<td>断签</td>
<td>0</td>
<td>0</td>
<td>465</td>
</tr>
<tr>
<td>第16天</td>
<td>1</td>
<td>1</td>
<td>15</td>
<td>480</td>
</tr>
<tr>
<td>第17天</td>
<td>2</td>
<td>1</td>
<td>20</td>
<td>500</td>
</tr>
<tr>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr>
<td>第30天</td>
<td>7</td>
<td>1</td>
<td>45</td>
<td>930</td>
</tr>
</tbody>
<tfoot>
<tr>
<td colspan="5">
                                                计算公式：前14天465分 + 后15天465分 = <strong>930分</strong>
</td>
</tr>
</tfoot>
</table>
</div>
<div class="points-tips">
<p><i class="fas fa-lightbulb"></i> <strong>计算说明：</strong></p>
<ul>
<li>第1-7天：积分逐步增加，累计<strong>210分</strong></li>
<li>第8天起：每天固定获得<strong>45分</strong></li>
<li>断签后：从15分重新开始计算</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<!-- 修改技术支持页面内容 -->
<div class="page-content" id="support" style="display:none">
<div class="content-card">
<div style="text-align: center; padding: 50px;">
<h2>跳转到LittleSkin皮肤站</h2>
<p>点击下方按钮跳转到皮肤站管理您的皮肤</p>
<button class="action-button" onclick="window.open('https://littlesk.in', '_blank')" style="margin-top: 20px;">
<i class="fas fa-external-link-alt"></i> 前往皮肤站
                        </button>
</div>
</div>
</div>
</div>
</div>
<script>
        // 页面状态管理
        let isLoggedIn = false;
        let isAdmin = false;
        let currentEditingItem = null;
        let refreshTimer = null;
        let currentPage = 'user-center';
        let isRegistering = false;
        let latestLeaderboardData = [];
        let isResettingPassword = false;
        let signData = {
            signedDays: [],
            consecutiveDays: 0,
            totalDays: 0,
            lastSign: "",
            points: 0
        };
        let userData = {
            username: '',
            password: '',
            avatar: 'data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'100\' height=\'100\' viewBox=\'0 0 100 100\'%3E%3Ccircle cx=\'50\' cy=\'40\' r=\'20\' fill=\'%233498db\'/%3E%3Ccircle cx=\'50\' cy=\'100\' r=\'40\' fill=\'%233498db\'/%3E%3C/svg%3E',
            status: '在线',
            points: 0,
            joinDate: '',
            lastLogin: '',
            serverStatus: '未登录',
            onlineTime: 0,
            signStatus: {
                signedDays: [],
                currentDay: new Date().getDate(),
                consecutiveDays: 0
            }
        };

        // API基础URL
        const API_BASE_URL = '/api';

        // 显示通知
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type} show`;

            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // 显示加载动画
        function showLoading(show) {
            const loadingOverlay = document.getElementById('loading-overlay');
            loadingOverlay.style.display = show ? 'flex' : 'none';
        }
        // 打开商品弹窗
        function openItemModal(item = null) {
            currentEditingItem = item;
            const modal = document.getElementById('item-modal');
            const title = document.getElementById('item-modal-title');

            if (item) {
                title.textContent = '编辑商品';
                document.getElementById('item-name').value = item.name;
                document.getElementById('item-id').value = item.itemId;
                document.getElementById('item-points').value = item.points;
                document.getElementById('item-stock').value = item.stock;
                document.getElementById('item-image').value = item.image || '';
                document.getElementById('item-description').value = item.description || '';
            } else {
                title.textContent = '添加商品';
                document.getElementById('item-name').value = '';
                document.getElementById('item-id').value = '';
                document.getElementById('item-points').value = '';
                document.getElementById('item-stock').value = '';
                document.getElementById('item-image').value = '';
                document.getElementById('item-description').value = '';
            }

            modal.style.display = 'flex';
        }

        // 关闭商品弹窗
        function closeItemModal() {
            document.getElementById('item-modal').style.display = 'none';
        }

        // 保存商品
        async function saveShopItem() {
            const name = document.getElementById('item-name').value;
            const itemId = document.getElementById('item-id').value;
            const points = document.getElementById('item-points').value;
            const stock = document.getElementById('item-stock').value;
            const image = document.getElementById('item-image').value;
            const description = document.getElementById('item-description').value;

            if (!name || !itemId || !points || !stock) {
                showNotification('请填写必填字段', 'error');
                return;
            }

            const itemData = {
                name,
                itemId,
                points: parseInt(points),
                stock: parseInt(stock),
                image: image || 'images/default_item.png',
                description: description || '暂无描述'
            };

            if (currentEditingItem) {
                itemData.id = currentEditingItem.id;
            }

            try {
                showLoading(true);
                const method = currentEditingItem ? 'updateShopItem' : 'addShopItem';
                const session = localStorage.getItem('adminSession');
                if (!session) {
                    showNotification('管理员会话已过期，请重新登录', 'error');
                    return;
                }
                const response = await fetch(`${API_BASE_URL}?method=${method}&session=${session}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(itemData)
                });
                const data = await response.json();
                if (data.success) {
                    showNotification(`商品${currentEditingItem ? '更新' : '添加'}成功`);
                    closeItemModal();
                    refreshShop();
                } else {
                    showNotification(`操作失败: ${data.message || '未知错误'}`, 'error');
                }
            } catch (error) {
                console.error('保存商品失败:', error);
                showNotification('保存失败', 'error');
            } finally {
                showLoading(false);
            }
        }

        // 删除商品
        async function deleteItem(itemId) {
            if (!confirm('确定要删除这个商品吗？')) return;

            try {
                showLoading(true);
                const response = await fetch(`${API_BASE_URL}?method=deleteShopItem&itemId=${itemId}`);
                const data = await response.json();

                if (data.success) {
                    showNotification('商品已删除');
                    refreshShop();
                } else {
                    showNotification(data.message, 'error');
                }
            } catch (error) {
                console.error('删除商品失败:', error);
                showNotification('删除失败', 'error');
            } finally {
                showLoading(false);
            }
        }

        async function purchaseItem(itemId) {
            try {
                // 获取商品信息
                const shopItemsResponse = await fetch(`${API_BASE_URL}?method=getShopItems`);
                const shopItemsData = await shopItemsResponse.json();

                if (!shopItemsData.success) {
                    showNotification('获取商品信息失败', 'error');
                    return;
                }

                const item = shopItemsData.items.find(i => i.id === itemId);
                if (!item) {
                    showNotification('商品不存在', 'error');
                    return;
                }

                // 二次确认
                const isConfirmed = confirm(`确定要兑换 ${item.name} 吗？需要花费 ${item.points} 积分。`);
                if (!isConfirmed) {
                    return;
                }

                showLoading(true);
                const response = await fetch(`${API_BASE_URL}?method=purchaseItem&username=${userData.username}&itemId=${itemId}`);
                const data = await response.json();

                if (data.success) {
                    // 显示兑换码弹窗
                    document.getElementById('coupon-item-name').textContent = data.item.name;
                    document.getElementById('coupon-code').textContent = data.coupon;
                    document.getElementById('coupon-modal').style.display = 'flex';

                    // 刷新积分显示
                    document.getElementById('user-points').textContent = parseInt(document.getElementById('user-points').textContent) - data.item.points;
                    // 刷新商城
                    refreshShop();
                } else {
                    showNotification(`兑换失败: ${data.message}`, 'error');
                }
            } catch (error) {
                console.error('兑换商品失败:', error);
                showNotification('兑换失败', 'error');
            } finally {
                showLoading(false);
            }
        }
        // 添加礼包物品行
        function addBundleItem() {
            const container = document.getElementById('bundle-items-container');
            const div = document.createElement('div');
            div.className = 'bundle-item';
            div.innerHTML = `        <div class="group bundle-field">
            <input type="text" placeholder=" " title="物品ID" class="bundle-item-id input">
            <span class="highlight"></span>
            <span class="bar"></span>
            <label>物品ID</label>
        </div>
        <div class="group bundle-field">
            <input type="number" placeholder=" " title="数量" min="1" value="1" class="bundle-item-amount input">
            <span class="highlight"></span>
            <span class="bar"></span>
            <label>数量</label>
        </div>
        <button type="button" class="server-button small" onclick="removeBundleItem(this)">移除</button>`;
            container.appendChild(div);
        }

        // 移除礼包物品行
        function removeBundleItem(button) {
            button.parentElement.remove();
        }
        // 刷新商城
        async function refreshShop() {
            try {
                showLoading(true);

                // 获取商品列表
                const response = await fetch(`${API_BASE_URL}?method=getShopItems`);
                const data = await response.json();

                if (data.success) {
                    renderShopItems(data.items);
                }

                // 如果是管理员，显示兑换码管理
                if (isAdmin) {
                    const couponResponse = await fetch(`${API_BASE_URL}?method=getCoupons`);
                    const couponData = await couponResponse.json();

                    if (couponData.success) {
                        renderCoupons(couponData.coupons);
                        document.getElementById('coupon-management').style.display = 'block';
                    }
                }

            } catch (error) {
                console.error('刷新商城失败:', error);
                showNotification('刷新商城失败', 'error');
            } finally {
                showLoading(false);
            }
        }
        function copyCouponCode() {
            const couponCode = document.getElementById('coupon-code').textContent;
            navigator.clipboard.writeText(couponCode).then(() => {
                showNotification('兑换码已复制到剪贴板！');
            });
        }

        function CouponModal() {
            document.getElementById('coupon-modal').style.display = 'none';
        }
        function closeGenerateCouponModal() {
            document.getElementById('generate-coupon-modal').style.display = 'none';
        }
        // 渲染商品列表
        function renderShopItems(items) {
            const grid = document.getElementById('shop-items-grid');
            grid.innerHTML = '';

            items.forEach(item => {
                const itemCard = document.createElement('div');
                itemCard.className = 'shop-item-card';
                itemCard.innerHTML = `
            <div class="item-image">
                <img src="${item.image || 'images/default_item.png'}" alt="${item.name}">
            </div>
            <div class="item-details">
                <h3 class="item-name">${item.name}</h3>
                <p class="item-id">ID: ${item.itemId}</p>
                <p class="item-description">${item.description || '暂无描述'}</p>
                <div class="item-meta">
                    <span class="item-points">${item.points} 积分</span>
                    <span class="item-stock">库存: ${item.stock}</span>
                </div>
                <div class="item-actions">
                    ${isAdmin ? `
                        <button class="server-button small" onclick="openItemModal(${JSON.stringify(item)})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="server-button danger small" onclick="deleteItem('${item.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    ` : `
                        <button class="server-button primary ${item.stock <= 0 ? 'disabled' : ''}" 
                            ${item.stock <= 0 ? 'disabled' : ''}
                            onclick="purchaseItem('${item.id}')">
                            兑换
                        </button>
                    `}
                </div>
            </div>
        `;
                grid.appendChild(itemCard);
            });
        }

        // 修改 renderCoupons 函数
        function renderCoupons(coupons) {
            const tbody = document.getElementById('coupons-body');
            tbody.innerHTML = '';

            coupons.forEach(coupon => {
                // 计算使用状态
                let statusText;
                if (coupon.oneTimeUse) {
                    statusText = coupon.used ? '已使用' : '未使用';
                } else {
                    statusText = coupon.usedBy.length > 0
                        ? `已使用 (${coupon.usedBy.length}次)`
                        : '未使用';
                }

                // 显示玩家使用情况
                const playerUsed = coupon.designatedPlayer
                    ? coupon.designatedPlayer
                    : '未指定';

                // 将物品数组转换为字符串
                const itemInfo = coupon.items.map(item =>
                    `${item.itemId} x${item.amount}`
                ).join(', ');

                const row = document.createElement('tr');
                row.innerHTML = `
            <td>${coupon.code}</td>
            <td>${itemInfo}</td>
            <td>${playerUsed}</td>
            <td>${new Date(coupon.expiresAt).toLocaleDateString()}</td>
            <td>${statusText}</td>
            <td>
                <button class="server-button danger small" 
                    onclick="deleteCoupon('${coupon.code}')">
                    <i class="fas fa-trash"></i>
                </button>
            </td>
        `;
                tbody.appendChild(row);
            });
        }
        // 打开兑换码生成弹窗
        function openCouponModal() {
            // 重置表单状态
            document.getElementById('coupon-type').value = 'item';
            toggleCouponType();
            document.getElementById('generate-coupon-modal').style.display = 'flex';
        }

        // 关闭兑换码生成弹窗
        function closeGenerateCouponModal() {
            document.getElementById('generate-coupon-modal').style.display = 'none';
        }

        // 关闭兑换码显示弹窗
        function closeCouponModal() {
            document.getElementById('coupon-modal').style.display = 'none';
        }
        // 切换兑换码类型显示
        function toggleCouponType() {
            const type = document.getElementById('coupon-type').value;
            const itemGroup = document.getElementById('coupon-item-group');
            const bundleGroup = document.getElementById('coupon-bundle-group');

            // 重置所有组
            itemGroup.style.display = 'none';
            bundleGroup.style.display = 'none';

            // 根据类型显示对应组
            if (type === 'item') {
                itemGroup.style.display = 'block';
            } else if (type === 'bundle') {
                bundleGroup.style.display = 'block';
            }
        }
        // 修复前端生成兑换码函数
        async function generateCoupon() {
            const type = document.getElementById('coupon-type').value;
            const expires = document.getElementById('coupon-expires').value;
            const designatedPlayer = document.getElementById('coupon-designated').value || '';
            const oneTimeUse = document.getElementById('coupon-one-time').value === 'true';

            let items = [];

            if (type === 'item') {
                const itemId = document.getElementById('coupon-item-id').value;
                const amount = parseInt(document.getElementById('coupon-item-amount').value) || 1;
                if (itemId) {
                    items.push({ itemId, amount });
                } else {
                    showNotification('请输入物品ID', 'error');
                    return;
                }
            } else if (type === 'bundle') {
                const itemElements = document.querySelectorAll('.bundle-item');
                itemElements.forEach(item => {
                    const itemId = item.querySelector('.bundle-item-id').value;
                    const amount = parseInt(item.querySelector('.bundle-item-amount').value) || 1;
                    if (itemId) items.push({ itemId, amount });
                });

                if (items.length === 0) {
                    showNotification('请添加至少一个物品到礼包', 'error');
                    return;
                }
            }

            if (!expires) {
                showNotification('请选择过期时间', 'error');
                return;
            }

            try {
                showLoading(true);
                const session = localStorage.getItem('adminSession');
                if (!session) {
                    showNotification('管理员会话已过期，请重新登录', 'error');
                    return;
                }

                const response = await fetch(`${API_BASE_URL}?method=generateCoupon&session=${session}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        type,
                        items,
                        designatedPlayer,
                        expiresAt: expires,
                        oneTimeUse
                    })
                });

                const data = await response.json();
                if (data.success) {
                    showNotification(`兑换码生成成功: ${data.couponCode}`);
                    closeGenerateCouponModal();

                    // 显示兑换码弹窗
                    document.getElementById('coupon-item-name').textContent =
                        type === 'item' ? `物品: ${items[0].itemId} x ${items[0].amount}` :
                            `礼包 (${items.length} 个物品)`;
                    document.getElementById('coupon-code').textContent = data.couponCode;
                    document.getElementById('coupon-modal').style.display = 'flex';

                    // 刷新兑换码列表
                    refreshShop();
                } else {
                    showNotification(data.message, 'error');
                }
            } catch (error) {
                console.error('生成兑换码失败:', error);
                showNotification('生成兑换码失败', 'error');
            } finally {
                showLoading(false);
            }
        }
        // 删除兑换码
        async function deleteCoupon(code) {
            if (!confirm('确定要删除这个兑换码吗？')) return;

            try {
                showLoading(true);
                // 获取管理员会话
                const session = localStorage.getItem('adminSession');
                // 添加session参数到请求
                const response = await fetch(`${API_BASE_URL}?method=deleteCoupon&code=${code}&session=${session}`);
                const data = await response.json();

                if (data.success) {
                    showNotification('兑换码已删除');
                    refreshShop();
                } else {
                    showNotification(data.message, 'error');
                }
            } catch (error) {
                console.error('删除兑换码失败:', error);
                showNotification('删除失败', 'error');
            } finally {
                showLoading(false);
            }
        }
        document.getElementById('save-item-btn').addEventListener('click', saveShopItem);
        // 更新validateInput函数
        function validateInput(input, isUsername = false) {
            // 禁止空格和中文
            input.value = input.value.replace(/[\u4e00-\u9fa5\s]/g, '');

            // 如果是用户名字段，额外禁止@符号
            if (isUsername) {
                input.value = input.value.replace(/@/g, '');
            }
        }
        // 在脚本部分添加密码修改功能
        function changePassword() {
            const currentPassword = document.getElementById('current-password').value;
            const newPassword = document.getElementById('new-password').value;
            const confirmPassword = document.getElementById('confirm-password').value;

            if (!currentPassword) {
                showNotification('请输入当前密码', 'error');
                return;
            }

            if (!newPassword || newPassword.length < 6) {
                showNotification('新密码长度至少为6位', 'error');
                return;
            }

            if (newPassword !== confirmPassword) {
                showNotification('新密码和确认密码不一致', 'error');
                return;
            }

            // 显示加载动画
            showLoading(true);

            // 调用修改密码API
            fetch(`${API_BASE_URL}?method=changePassword&name=${userData.username}&oldpasswd=${currentPassword}&newpasswd=${newPassword}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showNotification('密码修改成功！');
                        clearPasswordFields();
                    } else {
                        showNotification(data.message || '密码修改失败', 'error');
                    }
                })
                .catch(error => {
                    console.error('修改密码错误:', error);
                    showNotification('修改密码失败，请稍后再试', 'error');
                })
                .finally(() => {
                    showLoading(false);
                });
        }

        // 清空密码字段
        function clearPasswordFields() {
            document.getElementById('current-password').value = '';
            document.getElementById('new-password').value = '';
            document.getElementById('confirm-password').value = '';
        }
        // 每日0点自动刷新签到状态
        function setupDailyReset() {
            const now = new Date();
            const hours = now.getHours();
            const minutes = now.getMinutes();

            // 计算到下一个0点的时间
            let timeUntilMidnight;
            if (hours === 23) {
                timeUntilMidnight = (60 - minutes) * 60 * 1000;
            } else {
                const midnight = new Date();
                midnight.setHours(24, 0, 0, 0);
                timeUntilMidnight = midnight - now;
            }

            setTimeout(() => {
                // 刷新用户签到数据
                if (isLoggedIn && currentPage === 'sign-page') {
                    fetchUserInfo().then(() => {
                        generateCalendar();
                        showNotification('新的一天开始了！签到已刷新');
                    });
                }

                // 设置下一个0点的定时器
                setupDailyReset();
            }, timeUntilMidnight);
        }
        // 初始化页面
        function initPage() {
            // 初始化用户签到状态
            if (!userData.signStatus) {
                userData.signStatus = {
                    signedDays: [],
                    consecutiveDays: 0,
                    totalDays: 0
                };
                setupDailyReset();
            }
            // 如果当前页面是排行榜，则刷新排行榜
            if (currentPage === 'leaderboard') {
                refreshLeaderboard();
            }
            // 检查登录状态
            const remember = localStorage.getItem('rememberLogin');
            if (remember === 'true') {
                const savedUsername = localStorage.getItem('username');
                if (savedUsername) {
                    document.getElementById('login-username').value = savedUsername;
                    document.getElementById('remember').checked = true;
                }
            }

            // 添加按钮事件监听器 - 修复点击无响应问题
            document.getElementById('server-login-btn').addEventListener('click', serverLogin);
            document.getElementById('server-logout-btn').addEventListener('click', serverLogout);
        }
        // 监听ESC键关闭弹窗
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeGenerateCouponModal();
                closeCouponModal();
            }
        });
        // 切换管理员登录模式
        function toggleAdminLogin() {
            const adminSection = document.getElementById('admin-login-section');
            const playerLoginBtn = document.getElementById('player-login-btn');
            const adminToggleBtn = document.getElementById('admin-toggle-btn');

            if (adminSection.style.display === 'none' || adminSection.style.display === '') {
                // 切换到管理员登录模式
                adminSection.style.display = 'block';
                playerLoginBtn.textContent = '管理员登录';
                playerLoginBtn.onclick = () => login('admin');
                adminToggleBtn.textContent = '返回玩家登录';
            } else {
                // 切换回玩家登录模式
                adminSection.style.display = 'none';
                playerLoginBtn.textContent = '玩家登录';
                playerLoginBtn.onclick = () => login('player');
                adminToggleBtn.textContent = '管理员登录';
            }
        }
        // 登录功能（完整版）
        async function login(type) {
            const username = document.getElementById('login-username').value;
            const password = document.getElementById('login-password').value;
            const remember = document.getElementById('remember').checked;
            let totp = '';

            const playerLoginBtn = document.getElementById('player-login-btn');
            const adminToggleBtn = document.getElementById('admin-toggle-btn');
            const originalPlayerText = playerLoginBtn.textContent;
            const originalAdminText = adminToggleBtn.textContent;

            // 管理员登录需要TOTP验证码
            if (type === 'admin') {
                totp = document.getElementById('login-totp').value;
                if (!totp) {
                    showNotification('请输入TOTP验证码！', 'error');
                    return;
                }
            }

            if (!username || !password) {
                showNotification('请输入用户名和密码！', 'error');
                return;
            }

            // 禁用按钮并显示加载
            playerLoginBtn.disabled = true;
            adminToggleBtn.disabled = true;
            playerLoginBtn.textContent = '登录中...';
            showLoading(true);

            try {
                let response;
                let result;

                if (type === 'admin') {
                    // 管理员登录 - 使用原来的API
                    const url = `${API_BASE_URL}?method=adminLogin&name=${username}&passwd=${password}&totp=${totp}`;
                    response = await fetch(url);
                    result = await response.json();

                    if (!result.success) {
                        showNotification(result.message, 'error');
                        return;
                    }

                    // 保存管理员session
                    localStorage.setItem('adminSession', result.session);
                    isAdmin = true;
                } else {
                    // 玩家登录 - 使用新的webLogin API
                    response = await fetch('/api/webLogin', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ username, password })
                    });

                    result = await response.json();

                    if (!result.success) {
                        showNotification(result.message, 'error');
                        return;
                    }

                    // 保存玩家session
                    localStorage.setItem('webSession', result.session);
                    isAdmin = false;
                }

                // 保存登录状态
                if (remember) {
                    localStorage.setItem('rememberLogin', 'true');
                    localStorage.setItem('username', username);
                } else {
                    localStorage.removeItem('rememberLogin');
                    localStorage.removeItem('username');
                }

                // 更新用户数据
                userData.username = username;
                userData.password = password;
                // 切换界面
                document.getElementById('login-page').style.display = 'none';
                document.getElementById('main-system').style.display = 'flex';
                document.getElementById('username-display').textContent = username;
                document.getElementById('account-username').textContent = username;

                // 获取用户详细信息
                await fetchUserInfo();

                // 根据登录类型更新界面
                if (isAdmin) {
                    // 管理员界面设置
                    document.getElementById('user-center-title').textContent = '用户管理';
                    document.getElementById('admin-user-management').style.display = 'block';
                    document.getElementById('user-status').textContent = '管理员';
                    // 显示管理员专用元素
                    document.querySelectorAll('.admin-only').forEach(el => {
                        el.style.display = 'block';
                    });
                    loadAdminUserData();
                } else {
                    // 玩家界面设置
                    document.getElementById('user-center-title').textContent = '服务器状态';
                    document.getElementById('admin-user-management').style.display = 'none';
                    document.getElementById('player-server-status').style.display = 'block';
                    // 隐藏管理员专用元素
                    document.querySelectorAll('.admin-only').forEach(el => {
                        el.style.display = 'none';
                    });
                    document.getElementById('user-status').textContent = '在线';
                }
                // 新增：默认只显示用户中心页面
                switchPage('user-center');
                showNotification('登录成功！');
                isLoggedIn = true;

            } catch (error) {
                console.error('登录错误:', error);
                showNotification('登录失败，请稍后再试: ' + error.message, 'error');
            } finally {
                // 恢复按钮状态
                playerLoginBtn.disabled = false;
                adminToggleBtn.disabled = false;
                playerLoginBtn.textContent = originalPlayerText;
                showLoading(false);
            }
        }

        // 打开注册/忘记密码弹窗
        function openModal(type) {
            document.getElementById('auth-modal').style.display = 'flex';
            switchAuthTab(type);
        }

        // 关闭弹窗
        function closeModal() {
            document.getElementById('auth-modal').style.display = 'none';
            // 重置表单
            document.getElementById('register-form').style.display = 'block';
            document.getElementById('forgot-form').style.display = 'none';
            document.getElementById('verification-form').style.display = 'none';
        }

        // 切换认证标签页
        function switchAuthTab(tab) {
            document.getElementById('register-tab').classList.remove('active');
            document.getElementById('forgot-tab').classList.remove('active');
            document.getElementById(tab + '-tab').classList.add('active');

            document.getElementById('register-form').style.display = 'none';
            document.getElementById('forgot-form').style.display = 'none';
            document.getElementById('verification-form').style.display = 'none';

            if (tab === 'register') {
                document.getElementById('modal-title').textContent = '注册新账号';
                document.getElementById('register-form').style.display = 'block';
            } else {
                document.getElementById('modal-title').textContent = '忘记密码';
                document.getElementById('forgot-form').style.display = 'block';
            }
        }

        // 注册功能（添加防重复点击）
        async function register() {
            // 防止重复提交
            if (isRegistering) return;
            isRegistering = true;

            const registerButton = document.querySelector('#register-form .login-button');
            const originalText = registerButton.textContent;
            registerButton.textContent = '发送中...';
            registerButton.disabled = true;

            const username = document.getElementById('reg-username').value;
            const password = document.getElementById('reg-password').value;
            const email = document.getElementById('reg-email').value;

            if (!username || !password || !email) {
                showNotification('请填写所有字段！', 'error');
                isRegistering = false;
                registerButton.textContent = originalText;
                registerButton.disabled = false;
                return;
            }

            try {
                // 调用注册API
                const response = await fetch(`${API_BASE_URL}?method=regist&name=${username}&passwd=${password}&email=${email}`);
                const result = await response.text();

                if (result.includes('验证码已发送')) {
                    showNotification('验证码已发送至您的邮箱，请查收！');
                    // 显示验证码表单
                    document.getElementById('register-form').style.display = 'none';
                    document.getElementById('verification-form').style.display = 'block';
                    document.getElementById('verify-button').onclick = () => verifyRegistration(email);
                    startVerificationTimer();
                } else {
                    showNotification(result, 'error');
                }
            } catch (error) {
                console.error('注册错误:', error);
                showNotification('注册失败，请稍后再试', 'error');
            } finally {
                isRegistering = false;
                registerButton.textContent = originalText;
                registerButton.disabled = false;
            }
        }

        // 验证注册
        async function verifyRegistration(email) {
            const code = document.getElementById('verification-code').value;

            if (!code) {
                showNotification('请输入验证码！', 'error');
                return;
            }

            try {
                // 调用验证注册API
                const response = await fetch(`${API_BASE_URL}?method=verifyRegist&email=${email}&code=${code}`);
                const result = await response.text();

                if (result.includes('注册成功')) {
                    showNotification('注册成功！');
                    closeModal();
                } else {
                    showNotification(result, 'error');
                }
            } catch (error) {
                console.error('验证注册错误:', error);
                showNotification('验证失败，请稍后再试', 'error');
            }
        }

        // 忘记密码功能（添加防重复点击）
        async function resetPassword() {
            // 防止重复提交
            if (isResettingPassword) return;
            isResettingPassword = true;

            const resetButton = document.querySelector('#forgot-form .login-button');
            const originalText = resetButton.textContent;
            resetButton.textContent = '发送中...';
            resetButton.disabled = true;

            const username = document.getElementById('forgot-username').value;
            const email = document.getElementById('forgot-email').value;
            const newPassword = document.getElementById('forgot-password').value;

            if (!username || !email || !newPassword) {
                showNotification('请填写所有字段！', 'error');
                isResettingPassword = false;
                resetButton.textContent = originalText;
                resetButton.disabled = false;
                return;
            }

            try {
                // 调用重置密码API
                const response = await fetch(`${API_BASE_URL}?method=repasswd&name=${username}&newpasswd=${newPassword}`);
                const result = await response.text();

                if (result.includes('验证码已发送')) {
                    showNotification('验证码已发送至您的邮箱，请查收！');
                    // 显示验证码表单
                    document.getElementById('forgot-form').style.display = 'none';
                    document.getElementById('verification-form').style.display = 'block';
                    document.getElementById('verify-button').onclick = () => verifyPasswordReset(email, username, newPassword);
                    startVerificationTimer();
                } else {
                    showNotification(result, 'error');
                }
            } catch (error) {
                console.error('重置密码错误:', error);
                showNotification('重置密码失败，请稍后再试', 'error');
            } finally {
                isResettingPassword = false;
                resetButton.textContent = originalText;
                resetButton.disabled = false;
            }
        }

        // 验证密码重置
        async function verifyPasswordReset(email, username, newPassword) {
            const code = document.getElementById('verification-code').value;

            if (!code) {
                showNotification('请输入验证码！', 'error');
                return;
            }

            try {
                // 调用验证API
                const response = await fetch(`${API_BASE_URL}?method=verifyCode&email=${email}&code=${code}`);
                const result = await response.text();

                if (result.includes('密码修改成功')) {
                    showNotification('密码重置成功！');
                    closeModal();
                } else {
                    showNotification(result, 'error');
                }
            } catch (error) {
                console.error('验证密码重置错误:', error);
                showNotification('验证失败，请稍后再试', 'error');
            }
        }

        // 开始验证码倒计时
        function startVerificationTimer() {
            let timeLeft = 300; // 5分钟
            const countdownElement = document.getElementById('verification-countdown');

            const timer = setInterval(() => {
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;

                countdownElement.textContent = `验证码有效时间：${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;

                if (timeLeft <= 0) {
                    clearInterval(timer);
                    countdownElement.textContent = '验证码已过期';
                }

                timeLeft--;
            }, 1000);
        }

        // 修改：服务器登录功能 - 立即更新状态
        async function serverLogin() {
            try {
                showLoading(true);
                const response = await fetch(`${API_BASE_URL}?method=login&name=${encodeURIComponent(userData.username)}&passwd=${encodeURIComponent(userData.password)}`);
                const result = await response.text();

                // 更灵活的成功判断
                if (result.includes('成功') || result.includes('确认') || result.includes('延长')) {
                    // 立即更新本地状态
                    userData.serverStatus = 'online';
                    updateServerStatus(userData.serverStatus);

                    showNotification('服务器登录成功！', 'success');

                    // 稍后刷新完整用户信息
                    setTimeout(() => {
                        fetchUserInfo();
                    }, 500);
                } else {
                    showNotification('服务器登录失败: ' + result, 'error');
                }
            } catch (error) {
                showNotification('服务器登录失败: ' + error.message, 'error');
            } finally {
                showLoading(false);
            }
        }

        // 修改：服务器登出功能 - 立即更新状态
        async function serverLogout() {
            try {
                showLoading(true);
                const response = await fetch(`${API_BASE_URL}?method=logout&name=${encodeURIComponent(userData.username)}&passwd=${encodeURIComponent(userData.password)}`);
                const result = await response.text();

                if (result.includes('退出')) {
                    // 立即更新本地状态
                    userData.serverStatus = 'offline';
                    updateServerStatus(userData.serverStatus);

                    showNotification('服务器登出成功！');

                    // 稍后刷新完整用户信息
                    setTimeout(() => {
                        fetchUserInfo();
                    }, 500);
                } else {
                    showNotification('服务器登出失败: ' + result, 'error');
                }
            } catch (error) {
                showNotification('服务器登出失败: ' + error.message, 'error');
            } finally {
                showLoading(false);
            }
        }
        // 修改 fetchUserInfo 函数
        async function fetchUserInfo() {
            try {
                // 强制从服务器获取最新数据（不使用缓存）
                const response = await fetch(`/api/userInfo?username=${userData.username}&t=${new Date().getTime()}`);
                const data = await response.json();

                if (data.success) {
                    // 更新用户数据
                    userData.joinDate = data.joinDate || '';
                    userData.onlineTime = data.onlineTime || 0;
                    userData.lastLogin = data.lastLogin || '';
                    userData.serverStatus = data.serverStatus || 'offline';

                    // 更新页面显示
                    document.getElementById('join-date').textContent = data.joinDate;
                    document.getElementById('last-login-date').textContent = data.lastLogin;
                    document.getElementById('online-time-total').textContent = formatTime(data.onlineTime || 0);

                    // 更新服务器状态显示
                    updateServerStatus(userData.serverStatus);

                    // 更新头像
                    if (data.avatarPath) {
                        document.getElementById('avatar-preview').src = data.avatarPath;
                        document.getElementById('user-avatar-img').src = data.avatarPath;
                        userData.avatar = data.avatarPath;
                    }
                }

                // 获取签到历史
                try {
                    const signResponse = await fetch(`/api/signHistory?username=${userData.username}&t=${new Date().getTime()}`);
                    const signDataResponse = await signResponse.json();

                    if (signDataResponse.success) {
                        // 更新全局签到数据
                        signData = {
                            signedDays: Object.keys(signDataResponse.signHistory || {}),
                            consecutiveDays: signDataResponse.consecutiveDays || 0,
                            totalDays: signDataResponse.totalDays || 0,
                            lastSign: signDataResponse.lastSign || "",
                            points: signDataResponse.points || 0
                        };

                        // 强制更新UI
                        updateSignButton();
                        if (currentPage === 'sign-page') {
                            generateCalendar();
                        }
                    }
                } catch (error) {
                    console.error('获取签到历史失败:', error);
                }
            } catch (error) {
                console.error('获取用户信息失败:', error);
            }
        }
        // 修改：状态更新函数 - 确保UI立即刷新
        function updateServerStatus(status) {
            const icon = document.getElementById('server-status-icon');
            const text = document.getElementById('server-status-text');
            const container = document.getElementById('server-status-container');

            // 清除所有可能的状态类
            container.className = 'server-status';

            // 确定是否在线
            const isOnline = status === 'online' ||
                status === '已登录' ||
                status === '登录成功' ||
                status === 'online';

            if (isOnline) {
                icon.className = 'fas fa-check-circle';
                icon.style.color = '#2ecc71'; // 绿色
                container.classList.add('status-online');
                text.textContent = '已登录';
                text.style.color = '#2ecc71'; // 绿色文字

                // 更新按钮状态
                document.getElementById('server-login-btn').style.display = 'none';
                document.getElementById('server-logout-btn').style.display = 'block';
            } else {
                icon.className = 'fas fa-times-circle';
                icon.style.color = '#e74c3c'; // 红色
                container.classList.add('status-offline');
                text.textContent = '未登录';
                text.style.color = '#e74c3c'; // 红色文字

                // 更新按钮状态
                document.getElementById('server-login-btn').style.display = 'block';
                document.getElementById('server-logout-btn').style.display = 'none';
            }

            // 更新其他信息
            document.getElementById('server-account').textContent = userData.username;
            document.getElementById('online-time').textContent = formatTime(userData.onlineTime);
            document.getElementById('last-login').textContent = userData.lastLogin || '从未登录';
        }
        // 修改：格式化时间显示 - 更精确
        function formatTime(ms) {
            if (!ms) return "0分钟";

            const seconds = Math.floor(ms / 1000);
            const minutes = Math.floor(seconds / 60);
            const hours = Math.floor(minutes / 60);
            const days = Math.floor(hours / 24);

            // 处理超大时间值
            if (days > 365) {
                const years = Math.floor(days / 365);
                const remainingDays = days % 365;
                return `${years}年${remainingDays}天`;
            }

            if (days > 0) {
                const remainingHours = hours % 24;
                return `${days}天${remainingHours}小时`;
            }
            if (hours > 0) {
                const remainingMinutes = minutes % 60;
                return `${hours}小时${remainingMinutes}分钟`;
            }
            if (minutes > 0) {
                return `${minutes}分钟`;
            }
            return `${seconds}秒`;
        }
        // 修改refreshPoints函数，从排行榜获取最新积分
        async function refreshPoints() {
            try {
                // 调用排行榜API获取最新数据
                const response = await fetch('/api/leaderboard?t=' + new Date().getTime());
                const data = await response.json();

                if (data.success) {
                    // 在排行榜中查找当前用户的积分
                    const currentUser = data.players.find(player => player.name === userData.username);
                    if (currentUser) {
                        // 更新本地数据
                        userData.points = currentUser.points;
                        document.getElementById('user-points').textContent = currentUser.points;
                    }
                }
            } catch (error) {
                console.error('刷新积分错误:', error);
            }
        }
        // 修改点1：优化服务器状态检测函数
        async function checkServerStatus(host, port) {
            const APIs = [
                { name: 'api.mcsrvstat.us', url: `https://api.mcsrvstat.us/3/${host}:${port}` },
                { name: 'mcapi.us', url: `https://mcapi.us/server/status?ip=${host}&port=${port}` }
            ];

            for (const api of APIs) {
                try {
                    const response = await fetch(api.url, { signal: AbortSignal.timeout(3000) });
                    if (!response.ok) continue;

                    const data = await response.json();
                    let online = false;
                    let players = { online: 0, max: 0 };

                    switch (api.name) {
                        case 'api.mcsrvstat.us':
                            online = data.online || false;
                            players = {
                                online: data.players?.online || 0,
                                max: data.players?.max || 0
                            };
                            break;
                        case 'mcapi.us':
                            online = data.online || false;
                            players = {
                                online: data.players?.now || 0,
                                max: data.players?.max || 0
                            };
                            break;
                    }

                    return { online, players };
                } catch (error) {
                    console.warn(`${api.name} 检测失败: ${error.message}`);
                }
            }

            return { online: false, players: { online: 0, max: 0 } };
        }

        async function getPortConfig() {
            try {
                if (fs.existsSync('ports.json')) {
                    return JSON.parse(fs.readFileSync('ports.json'));
                }
                return {};
            } catch (error) {
                console.error('读取端口配置错误:', error);
                return {};
            }
        }

        // 修改前端服务器状态刷新函数
        async function refreshServerStatus() {
            try {
                showLoading(true);
                const serverStatusGrid = document.getElementById('server-status-grid');
                serverStatusGrid.innerHTML = '';

                // 调用后端API获取服务器状态
                const response = await fetch('/api/serverStatus');
                const data = await response.json();

                if (!data.success) {
                    throw new Error('获取服务器状态失败');
                }

                serverStatusGrid.innerHTML = '';

                data.servers.forEach(server => {
                    const card = document.createElement('div');
                    card.className = `server-card ${server.online ? '' : 'offline'}`;

                    card.innerHTML = `
                <div class="server-header">
                    <div class="server-name">${server.name}</div>
                    <div class="server-status ${server.online ? 'status-online' : 'status-offline'}">
                        <i class="fas ${server.online ? 'fa-check-circle' : 'fa-times-circle'}"></i>
                        ${server.online ? '在线' : '离线'}
                    </div>
                </div>
                <div class="server-info">
                    <div class="server-address">${server.host}:${server.port}</div>
                    ${server.online ? `
                        <div class="server-stats">
                            <div class="stat-item">
                                <span class="stat-label">在线玩家</span>
                                <span class="stat-value">${server.players.online}/${server.players.max}</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">版本</span>
                                <span class="stat-value">${server.version}</span>
                            </div>
                        </div>
                        ${server.motd ? `<div class="server-motd">${server.motd}</div>` : ''}
                    ` : server.error ? `
                        <div class="server-stats">
                            <div class="stat-item">
                                <span class="stat-label">错误信息</span>
                                <span class="stat-value">${server.error}</span>
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;

                    serverStatusGrid.appendChild(card);
                });

                showNotification('服务器状态刷新完成！');
            } catch (error) {
                console.error('刷新服务器状态错误:', error);
                showNotification('刷新服务器状态失败', 'error');
            } finally {
                showLoading(false);
            }
        }

        // 加载管理员用户数据
        async function loadAdminUserData() {
            try {
                showLoading(true);
                const session = localStorage.getItem('adminSession');
                // 调用获取所有用户API
                const response = await fetch(`${API_BASE_URL}?method=getAllUsers&session=${session}`);
                const data = await response.json();

                if (!data.success) {
                    showNotification('获取用户数据失败: ' + data.message, 'error');
                    return;
                }

                const users = data.users;
                const tableBody = document.getElementById('user-table-body');
                tableBody.innerHTML = '';

                users.forEach(user => {
                    const row = document.createElement('tr');

                    let statusClass = '';
                    let statusText = '';

                    switch (user.status) {
                        case 'active':
                            statusClass = 'status-active';
                            statusText = '已激活';
                            break;
                        case 'inactive':
                            statusClass = 'status-inactive';
                            statusText = '未激活';
                            break;
                        case 'banned':
                            statusClass = 'status-banned';
                            statusText = '已封禁';
                            break;
                    }

                    row.innerHTML = `
    <td>${user.name}</td>
    <td>
        <span id="email-${user.name}">${user.email}</span>
        <button class="server-button primary small" 
            onclick="showEditEmail('${user.name}')">
            <i class="fas fa-edit"></i>
        </button>
    </td>
    <td class="${statusClass}">${statusText}</td>
    <td>${user.joinDate || '未知'}</td>
    <td>${user.lastLogin || '从未登录'}</td>
    <td>${formatTime(user.onlineTime || 0)}</td>
    <td>
        <div class="action-buttons">
            <button class="server-button ${user.status !== 'active' ? '' : 'disabled'}" 
                onclick="adminAction('activate', '${user.name}')" ${user.status === 'active' ? 'disabled' : ''}>
                激活
            </button>
            <button class="server-button danger ${user.status !== 'banned' ? '' : 'disabled'}" 
                onclick="adminAction('ban', '${user.name}')" ${user.status === 'banned' ? 'disabled' : ''}>
                封禁
            </button>
            <button class="server-button primary ${user.status === 'banned' ? '' : 'disabled'}" 
                onclick="adminAction('unban', '${user.name}')" ${user.status !== 'banned' ? 'disabled' : ''}>
                解封
            </button>
            <button class="server-button danger" 
                onclick="deleteUser('${user.name}')">
                <i class="fas fa-trash-alt"></i>
            </button>
        </div>
    </td>
`;

                    tableBody.appendChild(row);
                });

            } catch (error) {
                console.error('加载用户数据错误:', error);
                showNotification('加载用户数据失败', 'error');
            } finally {
                showLoading(false);
            }
        }

        // 管理员操作
        async function adminAction(action, username) {
            let actionText = '';
            let method = '';

            switch (action) {
                case 'activate':
                    actionText = '激活';
                    method = 'activateUser';
                    break;
                case 'ban':
                    actionText = '封禁';
                    method = 'banUser';
                    break;
                case 'unban':
                    actionText = '解封';
                    method = 'unbanUser';
                    break;
            }

            if (!confirm(`确定要${actionText}用户 ${username} 吗？`)) {
                return;
            }

            try {
                showLoading(true);
                const session = localStorage.getItem('adminSession');
                // 调用管理员操作API
                const response = await fetch(`${API_BASE_URL}?method=${method}&name=${username}&session=${session}`);
                const data = await response.json();

                if (data.success) {
                    showNotification(`用户 ${username} 已${actionText}`);
                    loadAdminUserData();
                } else {
                    showNotification(`${actionText}用户失败: ${data.message}`, 'error');
                }
            } catch (error) {
                console.error(`${actionText}用户错误:`, error);
                showNotification(`${actionText}用户失败`, 'error');
            } finally {
                showLoading(false);
            }
        }
        // 添加删除用户函数
        async function deleteUser(username) {
            if (!confirm(`确定要永久删除用户 ${username} 吗？此操作不可撤销！`)) {
                return;
            }

            try {
                showLoading(true);
                const session = localStorage.getItem('adminSession');
                const response = await fetch(`${API_BASE_URL}?method=deleteUser&name=${username}&session=${session}`);
                const data = await response.json();

                if (data.success) {
                    showNotification(`用户 ${username} 已永久删除`);
                    loadAdminUserData();
                } else {
                    showNotification(`删除用户失败: ${data.message}`, 'error');
                }
            } catch (error) {
                console.error(`删除用户错误:`, error);
                showNotification(`删除用户失败`, 'error');
            } finally {
                showLoading(false);
            }
        }
        // 添加邮箱编辑相关函数
        function showEditEmail(username) {
            const emailSpan = document.getElementById(`email-${username}`);
            const currentEmail = emailSpan.textContent;

            // 创建编辑表单
            emailSpan.innerHTML = `
        <input type="email" id="edit-email-${username}" value="${currentEmail}" 
            style="width: 150px; padding: 5px;">
        <button class="server-button success small" onclick="saveEmail('${username}')">
            <i class="fas fa-check"></i>
        </button>
        <button class="server-button danger small" onclick="cancelEditEmail('${username}', '${currentEmail}')">
            <i class="fas fa-times"></i>
        </button>
    `;
        }

        function cancelEditEmail(username, originalEmail) {
            document.getElementById(`email-${username}`).innerHTML = `
        ${originalEmail}
        <button class="server-button primary small" 
            onclick="showEditEmail('${username}')">
            <i class="fas fa-edit"></i>
        </button>
    `;
        }

        async function saveEmail(username) {
            const newEmail = document.getElementById(`edit-email-${username}`).value;
            if (!newEmail) {
                showNotification("邮箱不能为空", "error");
                return;
            }

            try {
                showLoading(true);
                const session = localStorage.getItem('adminSession');
                const response = await fetch(`${API_BASE_URL}?method=updateEmail&name=${username}&newEmail=${newEmail}&session=${session}`);
                const data = await response.json();

                if (data.success) {
                    showNotification("邮箱更新成功");
                    // 更新显示
                    document.getElementById(`email-${username}`).innerHTML = `
                ${newEmail}
                <button class="server-button primary small" 
                    onclick="showEditEmail('${username}')">
                    <i class="fas fa-edit"></i>
                </button>
            `;
                } else {
                    showNotification(`邮箱更新失败: ${data.message}`, "error");
                    // 恢复原值
                    const emailSpan = document.getElementById(`email-${username}`);
                    emailSpan.innerHTML = `
                <input type="email" id="edit-email-${username}" value="${newEmail}" 
                    style="width: 150px; padding: 5px;">
                <button class="server-button success small" onclick="saveEmail('${username}')">
                    <i class="fas fa-check"></i>
                </button>
                <button class="server-button danger small" onclick="cancelEditEmail('${username}', '${newEmail}')">
                    <i class="fas fa-times"></i>
                </button>
            `;
                }
            } catch (error) {
                console.error("保存邮箱错误:", error);
                showNotification("保存邮箱失败", "error");
            } finally {
                showLoading(false);
            }
        }
        // 替换 generateCalendar 函数
        function generateCalendar() {
            const calendar = document.getElementById('calendar');
            if (!calendar) return;
            calendar.innerHTML = '';

            // 使用周一到周日的顺序
            const weekdays = ['一', '二', '三', '四', '五', '六', '日'];
            weekdays.forEach(day => {
                const header = document.createElement('div');
                header.className = 'calendar-header';
                header.textContent = day;
                calendar.appendChild(header);
            });

            // 获取北京时间的当前日期
            const today = new Date();
            const todayStr = getBeijingDateString(today);

            // 计算本周的周一（北京时区）
            const beijingMonday = new Date(today);
            beijingMonday.setDate(beijingMonday.getDate() - (today.getDay() === 0 ? 6 : today.getDay() - 1));

            // 生成一周的日期（周一到周日）
            for (let i = 0; i < 7; i++) {
                const date = new Date(beijingMonday);
                date.setDate(beijingMonday.getDate() + i);
                const dateStr = getBeijingDateString(date);

                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';

                // 标记今天
                if (dateStr === todayStr) {
                    dayElement.classList.add('today');
                }

                // 标记已签到 / 未签到
                const isSigned = (signData.signedDays && signData.signedDays.includes(dateStr));
                if (isSigned) {
                    dayElement.classList.add('signed');
                } else {
                    // 标记未签到（仅今天之前的日期）
                    const d = new Date(dateStr + 'T00:00:00');
                    const t = new Date(todayStr + 'T00:00:00');
                    if (d < t) {
                        dayElement.classList.add('unsigned');
                    }
                }
dayElement.textContent = date.getDate();
                calendar.appendChild(dayElement);
            }

            // 更新签到按钮状态
            updateSignButton();
        }
        // 更新签到按钮状态
        function updateSignButton() {
            const signButton = document.getElementById('sign-button');
            if (!signButton) return;

            const todayStr = getBeijingDateString();
            const signedToday = signData.signedDays && signData.signedDays.includes(todayStr);

            if (signedToday) {
                signButton.textContent = '今日已签到';
                signButton.disabled = true;
                signButton.classList.add('disabled');

                // 显示连续签到天数
                if (signData.consecutiveDays > 1) {
                    signButton.textContent += ` (连续${signData.consecutiveDays}天)`;
                }
            } else {
                signButton.textContent = '立即签到';
                signButton.disabled = false;
                signButton.classList.remove('disabled');

                // 显示连续签到提示
                if (signData.consecutiveDays > 0) {
                    signButton.textContent = `签到 (保持连续${signData.consecutiveDays}天)`;
                }
            }
        }
        // 修复：统一使用北京时间的日期处理
        function getBeijingDateString(date = new Date()) {
            const now = date || new Date();
            // 获取北京时间 (UTC+8)
            const beijingTime = new Date(now.getTime() + (8 * 60 * 60 * 1000));
            // 格式化为 YYYY-MM-DD
            const year = beijingTime.getUTCFullYear();
            const month = (beijingTime.getUTCMonth() + 1).toString().padStart(2, '0');
            const day = beijingTime.getUTCDate().toString().padStart(2, '0');
            return `${year}-${month}-${day}`;
        }
        // 确保日期格式一致
        function formatDate(date) {
            const year = date.getFullYear();
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const day = date.getDate().toString().padStart(2, '0');
            return `${year}-${month}-${day}`;
        }
        // 添加：获取用户签到数据
        async function fetchUserSignData() {
            try {
                const session = localStorage.getItem('webSession');
                const response = await fetch(`/api/signHistory?username=${userData.username}&session=${session}`);
                const data = await response.json();

                if (data.success) {
                    // 更新全局签到数据
                    signData = {
                        signedDays: Object.keys(data.signHistory || {}),
                        consecutiveDays: data.consecutiveDays || 0,
                        totalDays: data.totalDays || 0,
                        lastSign: data.lastSign || "",
                        points: data.points || 0
                    };

                    // 生成日历
                    generateCalendar();
                    // 更新按钮状态
                    updateSignButton();
                }
            } catch (error) {
                console.error('获取签到数据失败:', error);
                showNotification('获取签到数据失败', 'error');
            }
        }
        // 修改点3：修改排行榜刷新函数，存储最新数据
        async function refreshLeaderboard() {
            try {
                showLoading(true);
                const response = await fetch('/api/leaderboard');
                const data = await response.json();

                if (data.success) {
                    // 存储到全局变量
                    latestLeaderboardData = data.players;
                    renderLeaderboard(latestLeaderboardData);
                } else {
                    showNotification('获取排行榜数据失败', 'error');
                }
            } catch (error) {
                console.error('刷新排行榜错误:', error);
                showNotification('刷新排行榜失败', 'error');
            } finally {
                showLoading(false);
            }
        }

        // 新增函数：渲染排行榜
        function renderLeaderboard(players) {
            const tbody = document.getElementById('leaderboard-body');
            tbody.innerHTML = '';

            players.forEach((player, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
            <td class="rank">${index + 1}</td>
            <td>
                <div class="player-info">
                    <img src="${player.avatar || 'data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'30\' height=\'30\' viewBox=\'0 0 30 30\'%3E%3Ccircle cx=\'15\' cy=\'12\' r=\'6\' fill=\'%233498db\'/%3E%3Ccircle cx=\'15\' cy=\'30\' r=\'12\' fill=\'%233498db\'/%3E%3C/svg%3E'}" 
                         alt="${player.name}" class="player-avatar">
                    <span>${player.name}</span>
                </div>
            </td>
            <td>${formatTime(player.onlineTime)}</td>
            <td>${player.lastLogin || '从未登录'}</td>
            <td>${player.consecutiveDays || 0}</td>
            <td>${player.points || 0}</td>
        `;
                tbody.appendChild(row);
            });
        }
        // 修改点4：添加账户设置刷新功能
        async function refreshAccountSettings() {
            try {
                showLoading(true);

                // 刷新用户信息
                await fetchUserInfo();

                // 刷新排行榜数据
                await refreshLeaderboard();

                // 从排行榜获取当前用户积分
                const currentUser = latestLeaderboardData.find(player => player.name === userData.username);
                if (currentUser) {
                    userData.points = currentUser.points;
                    document.getElementById('user-points').textContent = currentUser.points;
                }

                showNotification('账户信息已刷新！');
            } catch (error) {
                console.error('刷新账户设置失败:', error);
                showNotification('刷新账户设置失败', 'error');
            } finally {
                showLoading(false);
            }
        }
        // 修改签到函数
        async function signIn() {
            try {
                showLoading(true);

                // 调用签到API
                const response = await fetch(`/api/sign?username=${encodeURIComponent(userData.username)}`);
                const data = await response.json();

                if (data.success) {
                    // 立即更新本地状态
                    const todayStr = getBeijingDateString();

                    // 确保添加今天的签到日期
                    if (!signData.signedDays.includes(todayStr)) {
                        signData.signedDays.push(todayStr);
                    }

                    // 更新连续签到天数
                    signData.consecutiveDays = data.consecutiveDays;
                    signData.points = data.totalPoints;

                    // 更新用户积分显示
                    userData.points = data.totalPoints;
                    document.getElementById('user-points').textContent = userData.points;

                    // 更新UI
                    updateSignButton();
                    generateCalendar();

                    // 显示成功消息
                    let message = `签到成功！获得${data.points}积分`;
                    if (data.consecutiveDays > 1) {
                        message += `，已连续签到 ${data.consecutiveDays} 天！`;
                    }
                    showNotification(message);
                } else {
                    showNotification(data.message, 'error');
                }
            } catch (error) {
                console.error('签到失败:', error);
                showNotification('签到失败: ' + error.message, 'error');
            } finally {
                showLoading(false);
            }
        }
        // 切换页面
        function switchPage(page) {
            // 如果是管理员，禁止访问某些页面
            if (isAdmin && (page === 'account' || page === 'sign')) {
                page = 'user-center';
                showNotification('管理员无法访问此页面', 'warning');
            }
            // 如果是管理员，禁止访问签到页面
            if (isAdmin && page === 'sign-page') {
                page = 'user-center';
                showNotification('管理员无法访问签到页面', 'warning');
            }
            // 更新当前页面
            currentPage = page;
            // 特殊页面初始化
            if (page === 'server-status') {
                refreshServerStatus();
            } else if (page === 'sign-page') {
                // 每次进入签到页面时刷新签到数据
                fetchUserSignData();
            }
            else if (page === 'user-center') {
                fetchUserInfo();
                if (refreshTimer) clearInterval(refreshTimer);
                refreshTimer = setInterval(fetchUserInfo, 60000); // 确保用户中心刷新数据
            } else if (page === 'leaderboard') {
                refreshLeaderboard();
            }
            // 更新导航项激活状态
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('data-page') === page) {
                    item.classList.add('active');
                }
            });

            // 更新页面标题
            document.getElementById('page-title').textContent = getPageTitle(page);

            // 隐藏所有页面内容
            document.querySelectorAll('.page-content').forEach(content => {
                content.style.display = 'none';
            });

            // 显示当前页面内容
            document.getElementById(page).style.display = 'block';

            if (page === 'account') {  // 添加账户设置页面的自动刷新
                refreshAccountSettings();
            }
        }

        // 获取页面标题
        function getPageTitle(page) {
            const titles = {
                'user-center': '用户中心',
                'sign': '签到系统',
                'leaderboard': '排行榜',
                'server-status': '服务器状态',
                'account': '账户设置',
                'support': 'LittleSkin皮肤站'
            };
            return titles[page] || '嘎嘣脆の小服';
        }

        // 退出登录
        function logout() {
            location.reload();
            isLoggedIn = false;
            isAdmin = false;
            document.getElementById('main-system').style.display = 'none';
            document.getElementById('login-page').style.display = 'flex';
            showNotification('您已退出登录');
        }

        // 头像上传
        document.getElementById('avatar-input').addEventListener('change', function (e) {
            const file = e.target.files[0];
            if (!file) return;
            // 检查文件大小 (限制为 9MB)
            if (file.size > 9 * 1024 * 1024) {
                showNotification('头像图片不能超过9MB', 'error');
                this.value = ''; // 清空文件选择
                return;
            }

            const reader = new FileReader();
            reader.onload = function (e) {
                const base64Image = e.target.result;

                // 调用后端API上传头像
                fetch('/api/uploadAvatar', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        username: userData.username,
                        avatar: base64Image
                    })
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            // 更新前端显示
                            document.getElementById('avatar-preview').src = data.avatarUrl;
                            document.getElementById('user-avatar-img').src = data.avatarUrl;
                            showNotification('头像更新成功！');
                        } else {
                            showNotification('头像上传失败', 'error');
                        }
                    });
            };
            reader.readAsDataURL(file);
        });

        // 初始化页面
        window.addEventListener('load', () => { initPage(); document.body.classList.remove('loading'); });
    

// ===== Theme toggle (Torch) =====
(function () {
  const STORAGE_KEY = 'theme';
  let lastToggleAt = 0;

  function applyTheme(theme) {
    const isDark = theme === 'dark';
    document.body.classList.toggle('theme-dark', isDark);
    document.body.classList.toggle('theme-light', !isDark);

    const cb = document.getElementById('theme-toggle-checkbox');
    // Torch lit = Light theme
    if (cb) cb.checked = !isDark;

    try { localStorage.setItem(STORAGE_KEY, theme); } catch (e) {}
  }

  function safeApply(theme) {
    const now = Date.now();
    // Prevent double-trigger on mobile tap (label + container / synthetic click)
    if (now - lastToggleAt < 250) return;
    lastToggleAt = now;
    applyTheme(theme);
  }

  function initThemeToggle() {
    const cb = document.getElementById('theme-toggle-checkbox');
    const saved = (() => { try { return localStorage.getItem(STORAGE_KEY); } catch (e) { return null; } })();
    const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
    const initial = saved ? saved : (prefersDark ? 'dark' : 'light');
    applyTheme(initial);

    if (cb) {
      cb.addEventListener('change', () => safeApply(cb.checked ? 'light' : 'dark'));

      // Fix: on some mobile browsers, tapping the torch can bubble to the nav item and toggle twice.
      cb.addEventListener('click', (e) => e.stopPropagation());
      const label = cb.closest('.torch-container');
      if (label) {
        label.addEventListener('click', (e) => e.stopPropagation());
        label.addEventListener('touchend', (e) => e.stopPropagation(), { passive: true });
      }
    }

    const item = document.getElementById('theme-toggle-item');
    if (item) {
      const toggle = () => safeApply(document.body.classList.contains('theme-dark') ? 'light' : 'dark');

      item.addEventListener('click', (e) => {
        // avoid double trigger when clicking checkbox/label directly
        if (e.target && (e.target.id === 'theme-toggle-checkbox' || e.target.closest('.torch-container'))) return;
        toggle();
      });

      item.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          toggle();
        }
      });

      // Improve tap response and consistency on mobile
      item.addEventListener('touchend', (e) => {
        if (e.target && (e.target.id === 'theme-toggle-checkbox' || e.target.closest('.torch-container'))) return;
        e.preventDefault();
        toggle();
      }, { passive: false });
    }
  }

  document.addEventListener('DOMContentLoaded', initThemeToggle);
document.addEventListener('DOMContentLoaded', () => {
  // Login: press Enter to trigger the login button (restored)
  const triggerLogin = (e) => {
    if (e.key === 'Enter') {
      e.preventDefault();
      const btn = document.getElementById('player-login-btn');
      if (btn) btn.click();
    }
  };

  const pw = document.getElementById('login-password');
  const un = document.getElementById('login-username');
  const totp = document.getElementById('login-totp');

  if (pw) pw.addEventListener('keydown', triggerLogin);
  if (un) un.addEventListener('keydown', triggerLogin);
  if (totp) totp.addEventListener('keydown', triggerLogin);
});
})();
// ===== /Theme toggle (Torch) =====

</script>
</div>
</body>
</html>